{
    "$schema": "http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#",
    "contentVersion": "1.0.0.0",
    "parameters": {
    "instance-count": {
            "type": "int",
            "metadata": {
                "description": "Number of session hosts that will be created and added to the hostpool."
            },
            "defaultValue": 2
        },
        "rdsh-prefix": {
            "type": "string",
            "metadata": {
                "description": "This prefix will be used in combination with the VM number to create the VM name. This value includes the dash, so if using “rdsh” as the prefix, VMs would be named “rdsh-0”, “rdsh-1”, etc. You should use a unique prefix to reduce name collisions in Active Directory."
            },
            "defaultValue": "rdsh"
        },
        "location": {
            "type": "String"
        },
        "ExclusionsPaths": {
            "defaultValue": "",
            "type": "String",
            "metadata": {
                "description": "Semicolon delimited list of file paths or locations to exclude from scanning"
            }
        },
        "ExclusionsExtensions": {
            "defaultValue": "",
            "type": "String",
            "metadata": {
                "description": "Semicolon delimited list of file extensions to exclude from scanning"
            }
        },
        "ExclusionsProcesses": {
            "defaultValue": "",
            "type": "String",
            "metadata": {
                "description": "Semicolon delimited list of process names to exclude from scanning"
            }
        },
        "RealtimeProtectionEnabled": {
            "defaultValue": "true",
            "type": "String",
            "metadata": {
                "description": "Indicates whether or not real time protection is enabled (default is true)"
            }
        },
        "ScheduledScanSettingsIsEnabled": {
            "defaultValue": "false",
            "type": "String",
            "metadata": {
                "description": "Indicates whether or not custom scheduled scan settings are enabled (default is false)"
            }
        },
        "ScheduledScanSettingsScanType": {
            "defaultValue": "Quick",
            "type": "String",
            "metadata": {
                "description": "Indicates whether scheduled scan setting type is set to Quick or Full (default is Quick)"
            }
        },
        "ScheduledScanSettingsDay": {
            "defaultValue": "7",
            "type": "String",
            "metadata": {
                "description": "Day of the week for scheduled scan (1-Sunday, 2-Monday, ..., 7-Saturday)"
            }
        },
        "ScheduledScanSettingsTime": {
            "defaultValue": "120",
            "type": "String",
            "metadata": {
                "description": "When to perform the scheduled scan, measured in minutes from midnight (0-1440). For example: 0 = 12AM, 60 = 1AM, 120 = 2AM."
            }
        }
    },
    "resources": [
        {
            "type": "Microsoft.Compute/virtualMachines/extensions",
            "apiVersion": "2015-06-15",
            "name": "[concat(parameters('rdsh-prefix'), copyindex(), '/', 'IaaSAntimalware')]",
            "location": "[parameters('location')]",
                "copy": {
                "name": "rdsh-iaas-malware-loop",
                "count": "[parameters('instance-count')]"
            },
            "properties": {
                "publisher": "Microsoft.Azure.Security",
                "type": "IaaSAntimalware",
                "typeHandlerVersion": "1.3",
                "autoUpgradeMinorVersion": true,
                "settings": {
                    "AntimalwareEnabled": true,
                    "RealtimeProtectionEnabled": "[parameters('RealtimeProtectionEnabled')]",
                    "ScheduledScanSettings": {
                        "isEnabled": "[parameters('ScheduledScanSettingsIsEnabled')]",
                        "day": "[parameters('ScheduledScanSettingsDay')]",
                        "time": "[parameters('ScheduledScanSettingsTime')]",
                        "scanType": "[parameters('ScheduledScanSettingsScanType')]"
                    },
                    "Exclusions": {
                        "Extensions": "[parameters('ExclusionsExtensions')]",
                        "Paths": "[parameters('ExclusionsPaths')]",
                        "Processes": "[parameters('ExclusionsProcesses')]"
                    }
                }
            }
        }
    ]
}