{
   "$schema":"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
   "contentVersion":"1.0.0.0",
   "parameters":{
      "location":{
         "type":"string",
         "allowedValues":[
            "Australia Southeast",
            "Australia East",
            "Australia Southeast",
            "Central US",
            "East US",
            "East US 2",
            "North Central US",
            "South Central US",
            "West Central US",
            "West US",
            "West US 2",
            "South Africa North",
            "East Asia",
            "Southeast Asia",
            "UK South",
            "UK West",
            "Japan East",
            "Southeast Asia",
            "West Europe",
            "North Europe",
            "France Central",
            "Central India",
            "Korea Central",
            "Switzerland North",
            "Canada Central",
            "China East 2"
         ],
         "defaultValue":"West Europe"
      },
      "workspace":{
         "type":"string",
         "defaultValue":"enterAuniqueDnsHostName"
      }
   },
   "resources":[
      {
         "apiVersion":"2019-05-01",
         "name":"pid-829f34d0-ff76-42d3-b46f-f527d50ff819",
         "type":"Microsoft.Resources/deployments",
         "subscriptionId":"[subscription().subscriptionId]",
         "resourceGroup":"[resourceGroup().name]",
         "properties":{
            "mode":"Incremental",
            "template":{
               "$schema":"https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
               "contentVersion":"1.0.0.0",
               "resources":[
               ]
            }
         }
      },
      {
         "apiVersion":"2020-03-01-preview",
         "name":"[concat(parameters('workspace'),'-', uniqueString(resourceGroup().id,subscription().subscriptionId))]",
         "type":"Microsoft.OperationalInsights/workspaces",
         "location":"[parameters('location')]",
		 "id":"[resourceId('Microsoft.OperationalInsights/workspaces',concat(parameters('workspace'),'-', uniqueString(resourceGroup().id,subscription().subscriptionId)))]",
         "properties":{
            "sku":{
               "Name":"Standalone"
            },
            "retentionInDays":360
         },
         "resources":[
            {
               "apiVersion":"2020-03-01-preview",
               "name":"License overview",
               "type":"views",
               "location":"[parameters('location')]",
               "id":"[resourceId('Microsoft.OperationalInsights/workspaces/views',concat(parameters('workspace'),'-', uniqueString(resourceGroup().id,subscription().subscriptionId)),'License overview')]",
               "dependson":[
                  "[resourceId('Microsoft.OperationalInsights/workspaces',concat(parameters('workspace'),'-', uniqueString(resourceGroup().id,subscription().subscriptionId)))]"
               ],
               "properties":{
                  "id":"[resourceId('Microsoft.OperationalInsights/workspaces/views',concat(parameters('workspace'),'-', uniqueString(resourceGroup().id,subscription().subscriptionId)),'License overview')]",
                  "Name":"License overview",
                  "Author":"marcel.meurer@sepago.de",
                  "Source":"Local",
                  "Version":2,
                  "Dashboard":[
                     {
                        "Id": "[if(equals('1', '1'),'NumberTileListBuilderBlade','NumberTileListBuilderBlade')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"License",
                              "newGroup":false,
                              "useIcon":false
                           },
                           "Tile":{
                              "Legend":"Needed licenses for the selected time frame per month",
                              "Query":"ITPC_CTX_Session_CL|distinct UserName_s| count"
                           },
                           "List":{
                              "Query":"ITPC_CTX_Session_CL | where TimeGenerated > startofmonth(ago(180d)) | extend MonthYear=strcat(getyear(TimeGenerated),\".\",getmonth(TimeGenerated)) | summarize DistinctUsers=dcount(UserName_s) by MonthYear | order by MonthYear desc",
                              "HideGraph":false,
                              "enableSparklines":false,
                              "ColumnsTitle":{
                                 "Name":"Year.Month",
                                 "Value":"Needed Licenses"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":false,
                                 "values":[
                                    {
                                       "name":"Normal",
                                       "threshold":"Default",
                                       "color":"#009e49",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"60",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"90",
                                       "color":"#ba141a",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search {selected item} | sort by TimeGenerated desc",
                              "NavigationSelect":{
                                 "NavigationQuery":"search {selected item} | sort by TimeGenerated desc"
                              }
                           }
                        }
                     },
                     {
                        "Id": "[if(equals('1', '1'),'InformationBlade','InformationBlade')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "Title":"License",
                              "NewGroup":false,
                              "Color":"#0072c6"
                           },
                           "Header":{
                              "Image":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAP8AAABzCAYAAABXetRpAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjEuNWRHWFIAABJzSURBVHhe7Z1pcFTXlcfZJBYDBhsbDAJJLAIBlmQMwmwBgzBgsxpik8CYZDA2LrMkdgVcJsgz5YQwjiuaclHxFMkUlcUfXJVKpTKVD1OzfElS8yWpTM2STCqzqvcWWlhmknFmquc+5ejO6dv/t9zX77Xlp/Or+hXo9Tnn3l7+rW6p1T2uVCqJojgGhQdFUUy+8KAoiskXHhRFMfnCg6IoJl94UBTF5AsPiqKYfOFBURSTLzwoimLyhQdFUUy+8KAoiskXHhRFMfnCg6IoJl94UBTF5AsPiqKYfOFBURSTLzwoimLyhQdFUUy+8KAoiskXHhRFMfnCg6IoJl94UBTF5AsPiqKYfOFBURSTLzwoimLyhQdFUUy+8KAoiskXHnQUBCGZ6IzzwHMFQUgmOuM88FxBEEY/qSnNv+0dN7/E7X/hc2k6GaIzzgPPFQRh9NI7aVEpNaMFBjW/+eDfOHcC+c4nO+hQGTrjPPBcQRBGJ17B5jh1mXkdE+hLjc44DzxXEITRh3qY7wT6AH05Lr9+bynX3jVsduW2n9BhjXMHQP/V6IzzwHMFQRhd3Lp6rdMMc2rakrKvzdPT9y5vMGt0xnnguYIgjC6c5/nFfSe20ZfDmMF2yG/c/4/032HMOwSdcR54riAIowv0EN4M/9Dn/+h/1J3E6/TlML0TGiT8gvBRxi386ZnLf+qo/p9GNdnlWyT8gvBRxu87PzrdITWz/FeCOuM88FxBEEYXTrjvvPvNTfTlMDz8mYVrnRf5VPxqz7xT0BnngecKgjC6yK3a1pmaurgsnOZzfjPo/acvNkj4BSEBOEEeOHOpnr6sCP/tnut3c6sf18fM4DvojPPAcwVBGJ2gQCNSs1pL+Y893U9fanTGeeC5YVEba3E2F9TBz3SXhi5dXULtkXP3a+9NGzj3+Z+jtUcsbD5Yunn0pVnUUnNuvfH2+OLOo3Bvjv0nPvMjKo2V/tOvtfSfOA/3YJq+b2Up17ajhVpjJX3fqhbn4S7aBzfT8GhN9uNG3+FTPWhf2okLS6mZLZHs0ZlX2Hn0B/RlGep6mTN8+vZn/okOlaEzzgPPtcW5MZSd0TBOWFAq7j5W9gONsPQ9ffIHcA0fC9s/Di9QP9SdB5xnSuWa3slNsA6qbjzUFim9U5rxegFV1/2vaFSkOOcXrefr+AXOv871X6HzkDg9t13d1hoq+mhZK3IrtzlzK2b5Wt9YunPtxgIaEwp1Z3dlZF76oY6SvoOsW+R5XnTGeeC5Qcl3Pll+piJS3Xt9jpaworjneBeaZ2th4/45NDIQtuFP1TcuRKcHMdO4LtQN1QTNrsabR0410uiqQLNrIS0fiNTs1khuZ47qOXwdja0JOuM88NwghL5ntpCWCoS6xxtAM8Kq7ti+QaN9sQ0/Os1WGmXN3Rvv/zmaF4W0RCjU5V2PZtZK2oYvzstsUX81Fp/4xN/T+NjRGeeB5/qBzkDk1jcFv0JQfwRmlmy4Qkt4EjT8/SdfXYaOh5WWD0y2sXMxmhOltJQVudatj6BZtZS24gnqi0rnL/ZomVjRGeeB53pR3PXJX6PNR+3g+e5ptKQnqDdKaRlPgoY/DmkLgUD9UZtpXv88LRcYNKfW0lZcQT0x+GtaLjZ0xnnguV6ADcciLecJ6otDWs6VDzP8+S2H/pq24Umu88m/Rf3I7LJNpcELX+im1nGp6cu6UZ2b1BYI1O+pekRY3HuilF26EZ8eUtoOBNXHZaZp/Qe0bCzojPPAc93Itmy+hTZc4cSG31ILRD38vUA/lYUWth6+Q6WuqLqrZh90kvtPydUNaBD2GKbvW+V546gq/Oo5ZP/zrw46c4a6vzzYW9eI6zwc3oQPqA9J5RBUj6RyX4pdzwZ+np+e2w5Dcbvn+llUbyuNqwDVejp+wX9R6zDqth7oNsYdePnSOWqPHJ1xHniuG2ijpn37P/U2lQci27q1Ygad5InZg0xNW7KTyl1RNXWo15TKIWHC7/ccD/W4qc6D73cL1GdKpZ6gPlMq9cW5Y0b9FdYtukotrsA+U8tflxY27n8RznGR2iC59q5PoR43qS1ydMZ54LluoE2aUqk1zksVh2cYf3+MMNdEpu9ftZXKfcmt3t6HZnBT9yz9FpVXYBv+zLyOC9TqSeBwKKnFFdRjSqWeoD5TKvUF9VaoHiFSuSc3j5w6A/sNi3uOPUwtvqB+6PiIz7MyNbu1j1oiRWecB57rBtok13ytsS3Zxs6HB85cWkdfuoLWLjPEC2LgHEMqrcAm/KmZyw9TWyDQDKS6QzlDLRDUwx04e9n3qZYD6jW99WbPP1O5J6jXlEoDgfqRVO7J0OW3foR6kdQSiP7jZ9ehGUhqiRSdcR54rhtog6ZUGhup6UvhulwqtQLNMaXSCgKHv66xl1oCk7p3ReAXlFALhNdlFqz594HTF++hk6zgc9wcPN/tG/477/xpHvWaUnkgsss/BmeYUrknqA9J5VZkHuqAs0zza/d8hVoiQ2ecB57rBtogkspjAa1nSqVWoDmm+cf2wpdkBg0/lVuDZiGpPFbQuqZBwp9tfizy8Kv6e8x+JJV7gvqQVG4NmoWk8sjQGeeB57qBNuem30/Iw4LW4qZmLAu1bnbxBjiPO/DZN+DsuMOvnk4V0DxTKo8VtK5pkPCrusjDn36wLZLwq0do76I+0769z91LLdb01jcF+i0AlUeGzjgPPNeNoTd7gv2qz7D41O/9hkZUhZpVNGebZpdt+qCw9fBvbE3PfwTOM6WtlBF3+FWYqv6NRFSgdU2DhD81o2XUfudHPUgqDw2aaUqlkaEzzgPP9QJtMLCTFpX6Dnw69B8ywJk1lrZSRtzhd0DzTItPHM1QeaTceuPt05nGTrgmMkj4VU0c4YczTKncFdRjmprdWtX16YDmmqbnrP4FlUeCzjgPPNeL2z3Xz6NNhvBBGhkYMKPm0lbKGC3hV0YW/oFzl9H8QAYJvwPqNU3Pa/8plfuC+k1T9yz1vR5Qn2lqanPgP/xyA801df5cnsojQWecB57rR/r+VZ9EGw1j5sG292isL6i/1tJWykhC+AfOXJqaWfwYmmltlOF3pHJPUtOXwV7TvkMnfX/Pj/pMb3/lek3CH/X7OOiM88Bzg9B//GygF1UEVd2hRHKlxC1tpYyPavjzG/avBTOqNnD4PV7ibUotkN7JlR9V7Sa1eIL6TKm0KtBcJJVHgs44DzzXBpsr0NdJC39OYyGwp8bSVsoYLeHPLFgTKPzZpZsOoP6oDBr+4u5j81G/m+YbmRT3HP8hqnOzsO1woHdqQr2mVFoVaC6SyiNBZ5wHnhsG562J0MZtzTSsdX1bKFRvSqU1ZbSEf+gLf+wb/kjvrF0MGn4H1B+XtKQvqNdUXec1edhvvl13teiM88BzqyH38A54JmykURWgWlMqrSmjJfxU6grqCaLzfFo9zRt+azN0uqlN+B3QjKi98+43J9NyvqB+YG2e809oiPQ9EnXGeeC5UaAu7PNh/jx1RBpTBqozpdKaEnf4s6u3/wTNM6VyiLoRDX+WW1Bzq7cXqbUMVGtqG/78ml270JyopGUCg2YgqTw0aKbpwEuvjZ5f9YWh/6XX4BnzklrLQHWmQxe/uJ/Ka0bc4UezkFQOQfWmzkc+UbkrqM/UNvwOmYZHJ6NZ1UrjrcgG/K0HlYdC3WZ+iWaaUnlk6IzzwHPjotj1bAc6g8i7N94/TW2a3jr/N09U37HiOwMujIbwOzdYKq8gv3YP7Ckz4J/Owl7DMOEfAc0LY66969s00pqhy28FennvzeNn/4RarEHzkFQeGTrjPPDcuEFnEvgXVK4pHvh935f3OlJ5zYgz/GgOksohqN6079DJISr3BPWaVhX+Kj9HoO/Ap0/QqKpAs5FUbsXgK39wCM2qcJL3e/CHQWecB57rRX79U1W/zfDQpaut8MwynXf4ofIyUK1pataKm1ReNcUnPvFn9F9XkhB+KvUF9ZqGCb96pOf59wupKc0/U9/N//+YeqSibovO/w/fuf5tq/dICIJex8f8hn3WP5BDc5D9J1+N5LMQODrjPPBcL0Y2lp6zOtSNeQR+Jl2s+M7vAOqwU5pfppZQ8Fl0yJW4wo9mINX6f0ktENRjOvjKH66nck9Qr2mh66hV+DOL1n0dzRkxM69jDZXWjNs91+ehvSAHXn490DtNO6QfWA1nIKklUnTGeeC5XpgbzCxc+690UmDUvfxJc45pvvMpGP7C5gOvoHpkakbL8Btj2tA7seHvKucsW0UnQ4KGX323gj9BR8B+F6nFFdRTYYCXkfbWLfpP2GuYmtUa+C2oeyct/F80Y8Shi19cSaU1JzWV3lougHe/9t6L1OaKqvuF2eemmtdBbZGiM84Dz3XD61N6nLfwunXlnd1U6gnqN6VSCKr3Mtex88fUCklNX3YU9XGpFBI4/CNOaT5KrRUUPD60E1nYuP8QtbqC+pCFLQe/Ti1lqOvW9/IxVaFdSO2uoD5udsWWg1T6oYH25WZmyQb4rtV9e5+bjepdjfiFPRydcR54rhtwo8gpzaXC1qdz1DbuzrUbz6SmLs7BWhepFaIeOcxFPXE6cObSNVq+Auvwm4IPjgwqbcET1Odp3SLnjSZyzoenVpxmKW2hgvSsFb5/0kulHyrqKcfjaG9+Ot8Mnc8YQKf5SUvHgs44DzwXkVuz67too3GonhftoGVdUQ/pA7/BYlTS0hVUHf6Q0vK+9NY37kb9tZC2UAGqdbWusZSa3GTntKXOB2CUsks33SjuOxHo3ZLdULe1f4H7ikFaMjZ0xnnguQi00bikJX1x3jIZ9cdlrr2riZYu48MIPy0dGDSjFtLyFaDaWph/bN8jtAUrVO8H5qyopaViRWecB56LQJuNQ1ouMMOftw7mRK56CHz7ra/Cd7ytdfhpWStuHjn1LJplq/NhI9nlW4K+VNj1jThAbe1U1yVtw4rs0o2xPQLINnZOoGViRWecB57rRq5tx8/QxiNx/IL/pmWsufncuV/BmVFY3+h7Q6lV+J23LaclQ1Hcfczq5y6mmQVr/oNGBQovlUKq+TlHVNJWrBg4fXEHmhXaGF7I44XOOA881w91L7UXnpGQ5jp27qXRVdE7MbobVHbJxsBXSi3Cn2vd+igtVxWZeR2hbry3rrxT8WEqqI5LZa6gnlqabVr/VdqKNYWuZ+FMGzMNj7bTuJqhM84Dz7VB3RN+Nv1QsHe+5TpvsX275/rHaUykpB94+K/Qmn6mZrT8A42wImj4nVr16Ok76DSo+u5459qNt4YXiZjeSQv9L6Px853rqIdaIPm1u13nUIkn6mlEqOsqKmkboel7+nmr/afntlW9ZjXojPPAc6slM7e9TZ3RtuKe46XC5oMldQE5Z7wtv2FfG5XUDHXjbXHWHjh/uVTYdmTYm8fP/m4/a3ZFsh+b8HPUsbZi1zPDz0Gd0zOL1pWGur/8b4PnLtf0csos2TB8ffW/eOFN59+h179U8+upd0pzLG8p5ictHwl3b7zfpu6w2wZeuDB8O1NPs5xXX76Sbdlc88vTDZ1xHniuYEfY8Au/o//E+XZ0edXCQtczM2kbYwKdcR54rmCHhL860GXlmJpd3dtWo5lACT9XsEPCH46BM5fWo8tpRCoLjXrK9wCay01NbpLwcwU7JPzhQJfRiIPnuwN/WIcbt668MwHN5vaffFXCzxXskPDb4/d7fiqrivy6J+FsLpWOGXTGeeC5gh0SfjuKu4/NQpePVt0xUGlVwNmGVDpm0BnngecKdkj47XBe44EuH+3E6sMP5xqm71/1fSofM+iM88BzBTsk/Hagy8aUSq25eeTUSjQPSS1jCp1xHniuYIeE3w502SDvXLvRRS2BSM9ZBecgsyu2SPiRgh0SfjvQZePppIUvUGsF6XkdL8AeH6l9zKEzzgPPFeyQ8NvRW98UKrBRSdsYk+iM88BzBTsk/Pagy6cWDpy++CBtYUyiM84DzxXskPCHA11GcUrLjml0xnnguYIdEv5wFB4/8i10OUVtes7qX9KSYx6dcR54rmCHhL860GUVhVF/tn0S0BnngecKdkj4qyczr2MnuszCmF//VOAPRxlr6IzzwHMFOwbPd09Xfs9PKhd8KGw78r3U7FYYbGRm/ppScf8JuXwDoDPOA88VBCGZ6IzzwHMFQUgmOuM88FxBEJKJzjgPPFcQhGSiM84DzxUEIZnojPPAcwVBSCY64zzwXEEQkonOOA+8KIpjR3hQFMXkCw+Koph84UFRFJMvPCiKYvKFB0VRTL7woCiKyRceFEUx+cKDoigmX3hQFMXkCw+Koph0S+P+D6rUvRIRTa6RAAAAAElFTkSuQmCC",
                              "Label":"Information Part",
                              "Link":{
                                 "Label":"More info",
                                 "Url":"https://www.sepago.de/en/wvd-value-add-tools/"
                              }
                           },
                           "List":[
                              {
                                 "Title":"Let's monitor!",
                                 "Content":"## License information\n\nThis version seems to be a community/test version of Azure Monitor for WVD. We are offering a supported version for a low rate to our customers on a per-user per-month base (0.60 cents per distinct user per month). The supported versions additionally can be configured via command line parameters and store the secrets encrypted in the registry. Additionally, we have a Power BI template to use the data.\nContact sales@sepago.de to get your quote.\n\n#### Get your [Links](mailto://sales@sepago.de \"quot\") \n\n"
                              }
                           ]
                        }
                     }
                  ],
                  "OverviewTile":{
                     "Id": "[if(equals('1', '1'),'SingleNumberBuilderTile','SingleNumberBuilderTile')]",
                     "Type":"OverviewTile",
                     "Version":2,
                     "Configuration":{
                        "Tile":{
                           "Legend":"Needed licenses for the selected time frame per month (sales@sepago.de)",
                           "Query":"ITPC_CTX_Session_CL | distinct UserName_s | count"
                        },
                        "Advanced":{
                           "DataFlowVerification":{
                              "Enabled":false,
                              "Query":"search * | limit 1 | project TimeGenerated"
                           }
                        }
                     }
                  }
               }
            },
            {
               "apiVersion":"2020-03-01-preview",
               "name":"WVD Processes",
               "type":"views",
               "location":"[parameters('location')]",
               "id":"[resourceId('Microsoft.OperationalInsights/workspaces/views', concat(parameters('workspace'),'-', uniqueString(resourceGroup().id,subscription().subscriptionId)),'WVD Processes')]",
               "dependson":[
                  "[resourceId('Microsoft.OperationalInsights/workspaces', concat(parameters('workspace'),'-', uniqueString(resourceGroup().id,subscription().subscriptionId)))]"
               ],
               "properties":{
                  "id":"[resourceId('Microsoft.OperationalInsights/workspaces/views', concat(parameters('workspace'),'-', uniqueString(resourceGroup().id,subscription().subscriptionId)),'WVD Processes')]",
                  "Name":"WVD Processes",
                  "Author":"marcel.meurer@sepago.de",
                  "Source":"Local",
                  "Version":2,
                  "Dashboard":[
                     {
                        "Id": "[if(equals('1', '1'),'LineChartCalloutBuilderBlade','LineChartCalloutBuilderBlade')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"Reported Processes",
                              "newGroup":false,
                              "useIcon":false
                           },
                           "Header":{
                              "Title":"Processes by Worker",
                              "Subtitle":"count"
                           },
                           "LineChart":{
                              "Query":"ITPC_CTX_Process_CL | summarize AggregatedValue = dcount(NameInSession_s) by Worker_s",
                              "Callout":{
                                 "Title":"Avg",
                                 "Operation":"Average"
                              },
                              "yAxis":{
                                 "isLogarithmic":false
                              }
                           },
                           "List":{
                              "Query":"ITPC_CTX_Process_CL | summarize AggregatedValue = dcount(NameInSession_s) by Worker_s | sort by Worker_s asc",
                              "HideGraph":false,
                              "enableSparklines":true,
                              "ColumnsTitle":{
                                 "Name":"Worker",
                                 "Value":"Count"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":false,
                                 "values":[
                                    {
                                       "name":"Normal",
                                       "threshold":"Default",
                                       "color":"#009e49",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"60",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"90",
                                       "color":"#ba141a",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search {selected item} | sort by TimeGenerated desc",
                              "NavigationSelect":{
                                 "NavigationQuery":"search {selected item} | sort by TimeGenerated desc"
                              }
                           }
                        }
                     },
                     {
                        "Id": "[if(equals('1', '1'),'LineChartCalloutBuilderBlade','LineChartCalloutBuilderBlade')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"Process CPU Consumption (Avg)",
                              "newGroup":true,
                              "useIcon":false
                           },
                           "Header":{
                              "Title":"Overall by Process Name",
                              "Subtitle":"% CPU"
                           },
                           "LineChart":{
                              "Query":"ITPC_CTX_Process_CL | where Name_s != \"System Idle Process\" | summarize AggregatedValue = avg(PercentProcessorTime_d) by Name_s",
                              "Callout":{
                                 "Title":"Avg",
                                 "Operation":"Last Sample"
                              },
                              "yAxis":{
                                 "isLogarithmic":false
                              }
                           },
                           "List":{
                              "Query":"ITPC_CTX_Process_CL | where Name_s != \"System Idle Process\" | summarize AggregatedValue = avg(PercentProcessorTime_d) by Name_s",
                              "HideGraph":false,
                              "enableSparklines":true,
                              "operation":"Summary",
                              "ColumnsTitle":{
                                 "Name":"Name",
                                 "Value":"%"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":false,
                                 "values":[
                                    {
                                       "name":"Normal",
                                       "threshold":"Default",
                                       "color":"#009e49",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"60",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"90",
                                       "color":"#ba141a",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search in (ITPC_CTX_Process_CL) {selected item} | summarize CPU_Perc = avg(PercentProcessorTime_d) by UserName_s, Worker_s, bin(TimeGenerated, 1h) | sort by TimeGenerated desc | render timechart"
                           }
                        }
                     },
                     {
                        "Id": "[if(equals('1', '1'),'LineChartCalloutBuilderBlade','LineChartCalloutBuilderBlade')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"Process CPU Consumption (Max)",
                              "newGroup":false,
                              "useIcon":false
                           },
                           "Header":{
                              "Title":"Overall by Process Name",
                              "Subtitle":"% CPU"
                           },
                           "LineChart":{
                              "Query":"ITPC_CTX_Process_CL | where Name_s != \"System Idle Process\" | summarize AggregatedValue = avg(PercentProcessorTime_d) by Name_s",
                              "Callout":{
                                 "Title":"Max",
                                 "Operation":"Average"
                              },
                              "yAxis":{
                                 "isLogarithmic":false
                              }
                           },
                           "List":{
                              "Query":"ITPC_CTX_Process_CL | where Name_s != \"System Idle Process\" | summarize AggregatedValue = avg(PercentProcessorTime_d) by Name_s",
                              "HideGraph":false,
                              "enableSparklines":true,
                              "operation":"Summary",
                              "ColumnsTitle":{
                                 "Name":"Name",
                                 "Value":"%"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":false,
                                 "values":[
                                    {
                                       "name":"Normal",
                                       "threshold":"Default",
                                       "color":"#009e49",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"60",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"90",
                                       "color":"#ba141a",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search in (ITPC_CTX_Process_CL) {selected item} | summarize CPU_Perc = max(PercentProcessorTime_d) by UserName_s, Worker_s, bin(TimeGenerated, 1h) | sort by TimeGenerated desc | render timechart"
                           }
                        }
                     },
                     {
                        "Id": "[if(equals('1', '1'),'LineChartCalloutBuilderBlade','LineChartCalloutBuilderBlade')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"Process Memory Consumption Phy (Avg)",
                              "newGroup":true,
                              "useIcon":false
                           },
                           "Header":{
                              "Title":"Overall by Process Name",
                              "Subtitle":"Byte"
                           },
                           "LineChart":{
                              "Query":"ITPC_CTX_Process_CL | where Name_s != \"System Idle Process\" | summarize AggregatedValue = avg(WorkingSet_d) by Name_s",
                              "Callout":{
                                 "Title":"Avg",
                                 "Operation":"Average"
                              },
                              "yAxis":{
                                 "isLogarithmic":false
                              }
                           },
                           "List":{
                              "Query":"ITPC_CTX_Process_CL | where Name_s != \"System Idle Process\" | summarize AggregatedValue = avg(WorkingSet_d) by Name_s",
                              "HideGraph":false,
                              "enableSparklines":true,
                              "operation":"Summary",
                              "ColumnsTitle":{
                                 "Name":"Name",
                                 "Value":"Byte"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":false,
                                 "values":[
                                    {
                                       "name":"Normal",
                                       "threshold":"Default",
                                       "color":"#009e49",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"60",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"90",
                                       "color":"#ba141a",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search in (ITPC_CTX_Process_CL) {selected item} | summarize Memory_Byte = avg(WorkingSet_d) by UserName_s, Worker_s, bin(TimeGenerated, 1h) | sort by TimeGenerated desc | render timechart"
                           }
                        }
                     },
                     {
                        "Id": "[if(equals('1', '1'),'LineChartCalloutBuilderBlade','LineChartCalloutBuilderBlade')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"Process Memory Consumption Phy (Max)",
                              "newGroup":false,
                              "useIcon":false
                           },
                           "Header":{
                              "Title":"Overall by Process Name"
                           },
                           "LineChart":{
                              "Query":"ITPC_CTX_Process_CL | where Name_s != \"System Idle Process\" | summarize AggregatedValue = max(WorkingSet_d) by Name_s",
                              "Callout":{
                                 "Title":"Avg",
                                 "Operation":"Average"
                              },
                              "yAxis":{
                                 "isLogarithmic":false
                              }
                           },
                           "List":{
                              "Query":"ITPC_CTX_Process_CL | where Name_s != \"System Idle Process\" | summarize AggregatedValue = max(WorkingSet_d) by Name_s",
                              "HideGraph":false,
                              "enableSparklines":true,
                              "operation":"Summary",
                              "ColumnsTitle":{
                                 "Name":"Name",
                                 "Value":"Byte"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":false,
                                 "values":[
                                    {
                                       "name":"Normal",
                                       "threshold":"Default",
                                       "color":"#009e49",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"60",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"90",
                                       "color":"#ba141a",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search in (ITPC_CTX_Process_CL) {selected item} | summarize Memory_Byte = max(WorkingSet_d) by UserName_s, Worker_s, bin(TimeGenerated, 1h) | sort by TimeGenerated desc | render timechart"
                           }
                        }
                     },
                     {
                        "Id": "[if(equals('1', '1'),'LineChartCalloutBuilderBlade','LineChartCalloutBuilderBlade')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"Process IO Activity (Avg)",
                              "newGroup":true,
                              "useIcon":false
                           },
                           "Header":{
                              "Title":"Overall by Process name",
                              "Subtitle":"Byte/s"
                           },
                           "LineChart":{
                              "Query":"ITPC_CTX_Process_CL | where Name_s != \"System Idle Process\" | summarize AggregatedValue = avg(IODataBytesPersec_d) by Name_s",
                              "Callout":{
                                 "Title":"Avg",
                                 "Operation":"Last Sample"
                              },
                              "yAxis":{
                                 "isLogarithmic":false
                              }
                           },
                           "List":{
                              "Query":"ITPC_CTX_Process_CL | where Name_s != \"System Idle Process\" | summarize AggregatedValue = avg(IODataBytesPersec_d) by Name_s",
                              "HideGraph":false,
                              "enableSparklines":true,
                              "operation":"Summary",
                              "ColumnsTitle":{
                                 "Name":"Name",
                                 "Value":"Byte/s"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":false,
                                 "values":[
                                    {
                                       "name":"Normal",
                                       "threshold":"Default",
                                       "color":"#009e49",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"60",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"90",
                                       "color":"#ba141a",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search in (ITPC_CTX_Process_CL) {selected item} | summarize IO_BpS = avg(IODataBytesPersec_d) by UserName_s, Worker_s, bin(TimeGenerated, 1h) | sort by TimeGenerated desc | render timechart"
                           }
                        }
                     },
                     {
                        "Id": "[if(equals('1', '1'),'LineChartCalloutBuilderBlade','LineChartCalloutBuilderBlade')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"Process IO Activity (Max)",
                              "newGroup":false,
                              "useIcon":false
                           },
                           "Header":{
                              "Title":"Overall by Process name",
                              "Subtitle":"Byte/s"
                           },
                           "LineChart":{
                              "Query":"ITPC_CTX_Process_CL | where Name_s != \"System Idle Process\" | summarize AggregatedValue = max(IODataBytesPersec_d) by Name_s",
                              "Callout":{
                                 "Title":"Avg",
                                 "Operation":"Average"
                              },
                              "yAxis":{
                                 "isLogarithmic":false
                              }
                           },
                           "List":{
                              "Query":"ITPC_CTX_Process_CL | where Name_s != \"System Idle Process\" | summarize AggregatedValue = max(IODataBytesPersec_d) by Name_s",
                              "HideGraph":false,
                              "enableSparklines":true,
                              "operation":"Summary",
                              "ColumnsTitle":{
                                 "Name":"Name",
                                 "Value":"byte/s"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":false,
                                 "values":[
                                    {
                                       "name":"Normal",
                                       "threshold":"Default",
                                       "color":"#009e49",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"60",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"90",
                                       "color":"#ba141a",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search in (ITPC_CTX_Process_CL) {selected item} | summarize IO_BpS = max(IODataBytesPersec_d) by UserName_s, Worker_s, bin(TimeGenerated, 1h) | sort by TimeGenerated desc | render timechart"
                           }
                        }
                     }
                  ],
                  "OverviewTile":{
                     "Id": "[if(equals('1', '1'),'SingleQueryDonutBuilderTileV1','SingleQueryDonutBuilderTileV1')]",
                     "Type":"OverviewTile",
                     "Version":2,
                     "Configuration":{
                        "Donut":{
                           "Query":"ITPC_CTX_Process_CL | summarize AggregatedValue = dcount(NameInSession_s) by Worker_s | sort by AggregatedValue desc",
                           "CenterLegend":{
                              "Text":"Total",
                              "Operation":"Sum"
                           },
                           "Options":{
                              "colors":[
                                 "#00188f",
                                 "#0072c6",
                                 "#00bcf2"
                              ]
                           }
                        },
                        "Advanced":{
                           "DataFlowVerification":{
                              "Enabled":false,
                              "Query":"search *"
                           }
                        }
                     }
                  }
               }
            },
            {
               "apiVersion":"2020-03-01-preview",
               "name":"WVD Sessions",
               "type":"views",
               "location":"[parameters('location')]",
               "id":"[resourceId('Microsoft.OperationalInsights/workspaces/views', concat(parameters('workspace'),'-', uniqueString(resourceGroup().id,subscription().subscriptionId)),'WVD Sessions')]",
               "dependson":[
                  "[resourceId('Microsoft.OperationalInsights/workspaces', concat(parameters('workspace'),'-', uniqueString(resourceGroup().id,subscription().subscriptionId)))]"
               ],
               "properties":{
                  "id":"[resourceId('Microsoft.OperationalInsights/workspaces/views', concat(parameters('workspace'),'-', uniqueString(resourceGroup().id,subscription().subscriptionId)),'WVD Sessions')]",
                  "Name":"WVD Sessions",
                  "Author":"marcel.meurer@sepago.de",
                  "Source":"Local",
                  "Version":2,
                  "Dashboard":[
                     {
                        "Id": "[if(equals('1', '1'),'SingleQueryDonutBuilderBladeV1','SingleQueryDonutBuilderBladeV1')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"WVD Sessions",
                              "newGroup":false,
                              "useIcon":false
                           },
                           "Header":{
                              "Title":"WVD Sessions",
                              "Subtitle":"Unique Sessions State"
                           },
                           "Donut":{
                              "Query":"ITPC_CTX_Session_CL | summarize AggregatedValue = dcount(SessionHash_s) by ConnectionState_s | sort by AggregatedValue desc",
                              "CenterLegend":{
                                 "Text":"Total",
                                 "Operation":"Sum"
                              },
                              "Options":{
                                 "colors":[
                                    "#00188f",
                                    "#0072c6",
                                    "#00bcf2"
                                 ]
                              }
                           },
                           "List":{
                              "Query":"ITPC_CTX_PerfData_CL | where Category == \"Terminal Services\" and Counter_s == \"Active Sessions\" | summarize AggregatedValue = avg(value_d) by Worker_s",
                              "HideGraph":false,
                              "enableSparklines":true,
                              "ColumnsTitle":{
                                 "Name":"Worker",
                                 "Value":"Active Sessions"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":true,
                                 "values":[
                                    {
                                       "name":"Normal",
                                       "threshold":"Default",
                                       "color":"#009e49",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"20",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"40",
                                       "color":"#ba141a",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search {selected item} | sort by TimeGenerated desc",
                              "NavigationSelect":{
                                 "NavigationQuery":"search {selected item} | sort by TimeGenerated desc"
                              }
                           }
                        }
                     },
                     {
                        "Id": "[if(equals('1', '1'),'LineChartCalloutBuilderBlade','LineChartCalloutBuilderBlade')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"Session Output Bandwidth",
                              "newGroup":true,
                              "useIcon":false
                           },
                           "Header":{
                              "Title":"Average Bandwidth per Worker",
                              "Subtitle":"bit/s"
                           },
                           "LineChart":{
                              "Query":"ITPC_CTX_PerfData_CL | where Category == \"RemoteFX Network\" and Counter_s == \"Total Sent Rate\" and Instance_s != \"_Server Total\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, 1h) | sort by TimeGenerated desc | render timechart",
                              "Callout":{
                                 "Title":"Avg ",
                                 "Operation":"Average"
                              },
                              "yAxis":{
                                 "isLogarithmic":false
                              }
                           },
                           "List":{
                              "Query":"ITPC_CTX_PerfData_CL | where Category == \"RemoteFX Network\" and Counter_s == \"Total Sent Rate\" | summarize AggregatedValue = avg(value_d) by UserName_s, Worker_s",
                              "HideGraph":false,
                              "enableSparklines":true,
                              "operation":"Summary",
                              "ColumnsTitle":{
                                 "Name":"User",
                                 "Value":"bit/s"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":true,
                                 "values":[
                                    {
                                       "name":"Normal",
                                       "threshold":"Default",
                                       "color":"#009e49",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"200000",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"1000000",
                                       "color":"#ba141a",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search in (ITPC_CTX_PerfData_CL) {selected item} and Category == \"RemoteFX Network\" and Counter_s == \"Total Sent Rate\" | summarize AggregatedValue = avg(value_d) by bin(TimeGenerated, 5m) | sort by TimeGenerated desc"
                           }
                        }
                     },
                     {
                        "Id": "[if(equals('1', '1'),'LineChartCalloutBuilderBlade','LineChartCalloutBuilderBlade')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"Session Input Bandwidth",
                              "newGroup":false,
                              "useIcon":false
                           },
                           "Header":{
                              "Title":"Average Bandwidth per Worker",
                              "Subtitle":"bit/s"
                           },
                           "LineChart":{
                              "Query":"ITPC_CTX_PerfData_CL | where Category == \"RemoteFX Network\" and Counter_s == \"Total Received Rate\" and Instance_s != \"_Server Total\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, 1h) | sort by TimeGenerated desc | render timechart",
                              "Callout":{
                                 "Title":"Avg",
                                 "Operation":"Average"
                              },
                              "yAxis":{
                                 "isLogarithmic":false
                              }
                           },
                           "List":{
                              "Query":"ITPC_CTX_PerfData_CL | where Category == \"RemoteFX Network\" and Counter_s == \"Total Received Rate\" | summarize AggregatedValue = avg(value_d) by UserName_s, Worker_s",
                              "HideGraph":false,
                              "enableSparklines":true,
                              "operation":"Summary",
                              "ColumnsTitle":{
                                 "Name":"User",
                                 "Value":"bit/s"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":false,
                                 "values":[
                                    {
                                       "name":"Normal",
                                       "threshold":"Default",
                                       "color":"#009e49",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"60",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"90",
                                       "color":"#ba141a",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search in (ITPC_CTX_PerfData_CL) {selected item} and Category == \"RemoteFX Network\" and Counter_s == \"Total Received Rate\" | summarize AggregatedValue = avg(value_d) by bin(TimeGenerated, 5m) | sort by TimeGenerated desc"
                           }
                        }
                     },
                     {
                        "Id": "[if(equals('1', '1'),'LineChartCalloutBuilderBlade','LineChartCalloutBuilderBlade')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"Session TCP RTT",
                              "newGroup":false,
                              "useIcon":false
                           },
                           "Header":{
                              "Title":"Average RTT per Worker",
                              "Subtitle":"ms"
                           },
                           "LineChart":{
                              "Query":"ITPC_CTX_PerfData_CL | where Category == \"RemoteFX Network\" and Counter_s == \"Current TCP RTT\" and Instance_s != \"_Server Total\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, 1h) | sort by TimeGenerated desc | render timechart",
                              "Callout":{
                                 "Title":"Avg",
                                 "Operation":"Average"
                              },
                              "yAxis":{
                                 "isLogarithmic":false
                              }
                           },
                           "List":{
                              "Query":"ITPC_CTX_PerfData_CL | where Category == \"RemoteFX Network\" and Counter_s == \"Current TCP RTT\" | summarize AggregatedValue = avg(value_d) by UserName_s, Worker_s",
                              "HideGraph":false,
                              "enableSparklines":true,
                              "operation":"Summary",
                              "ColumnsTitle":{
                                 "Name":"User",
                                 "Value":"ms"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":true,
                                 "values":[
                                    {
                                       "name":"Normal",
                                       "threshold":"Default",
                                       "color":"#009e49",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"350",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"600",
                                       "color":"#ba141a",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search in (ITPC_CTX_PerfData_CL) {selected item} and Category == \"RemoteFX Network\" and Counter_s == \"Current TCP RTT\" | summarize AggregatedValue = avg(value_d) by bin(TimeGenerated, 5m) | sort by TimeGenerated desc"
                           }
                        }
                     },
                     {
                        "Id": "[if(equals('1', '1'),'LineChartCalloutBuilderBlade','LineChartCalloutBuilderBlade')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"Session Output TCP Line Speed",
                              "newGroup":false,
                              "useIcon":false
                           },
                           "Header":{
                              "Title":"Average Output Line Speed per Worker",
                              "Subtitle":"bit/s"
                           },
                           "LineChart":{
                              "Query":"ITPC_CTX_PerfData_CL | where Category == \"RemoteFX Network\" and Counter_s == \"Current TCP Bandwidth\" and Instance_s != \"_Server Total\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, 1h) | sort by TimeGenerated desc | render timechart",
                              "Callout":{
                                 "Title":"Avg",
                                 "Operation":"Average"
                              },
                              "yAxis":{
                                 "isLogarithmic":false
                              }
                           },
                           "List":{
                              "Query":"ITPC_CTX_PerfData_CL | where Category == \"RemoteFX Network\" and Counter_s == \"Current TCP Bandwidth\" | summarize AggregatedValue = avg(value_d) by UserName_s, Worker_s | sort by AggregatedValue desc",
                              "HideGraph":false,
                              "enableSparklines":true,
                              "operation":"Summary",
                              "ColumnsTitle":{
                                 "Name":"User",
                                 "Value":"Count"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":true,
                                 "values":[
                                    {
                                       "name":"Error",
                                       "threshold":"Default",
                                       "color":"#ba141a",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"1000000",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"2000000",
                                       "color":"#009e49",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search in (ITPC_CTX_PerfData_CL) {selected item} and Category == \"RemoteFX Network\" and Counter_s == \"Current TCP Bandwidth\" | summarize AggregatedValue = avg(value_d) by bin(TimeGenerated, 5m) | sort by TimeGenerated desc"
                           }
                        }
                     },
                     {
                        "Id": "[if(equals('1', '1'),'LineChartCalloutStackedBuilderBlade','LineChartCalloutStackedBuilderBlade')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"Session Maximum Values",
                              "newGroup":true
                           },
                           "charts":[
                              {
                                 "Header":{
                                    "Title":"Maximum Output Bandwidth",
                                    "Subtitle":"bit/s"
                                 },
                                 "LineChart":{
                                    "Query":"ITPC_CTX_PerfData_CL | where Category == \"RemoteFX Network\" and Counter_s == \"Total Sent Rate\" | summarize AggregatedValue = max(value_d) by Worker_s, bin(TimeGenerated, 1h) | sort by TimeGenerated desc | render timechart",
                                    "yAxis":{
                                       "isLogarithmic":false
                                    }
                                 }
                              },
                              {
                                 "Header":{
                                    "Title":"Maximum Input Bandwidth",
                                    "Subtitle":"bit/s"
                                 },
                                 "LineChart":{
                                    "Query":"ITPC_CTX_PerfData_CL | where Category == \"RemoteFX Network\" and Counter_s == \"Total Received Rate\" | summarize AggregatedValue = max(value_d) by Worker_s, bin(TimeGenerated, 1h) | sort by TimeGenerated desc | render timechart",
                                    "yAxis":{
                                       "isLogarithmic":false
                                    }
                                 }
                              },
                              {
                                 "Header":{
                                    "Title":"Maximum RTT",
                                    "Subtitle":"ms"
                                 },
                                 "LineChart":{
                                    "Query":"ITPC_CTX_PerfData_CL | where Category == \"RemoteFX Network\" and Counter_s == \"Current TCP RTT\" | summarize AggregatedValue = max(value_d) by Worker_s, bin(TimeGenerated, 1h) | sort by TimeGenerated desc | render timechart",
                                    "yAxis":{
                                       "isLogarithmic":false
                                    }
                                 }
                              }
                           ]
                        }
                     },
                     {
                        "Id": "[if(equals('1', '1'),'NotableQueriesBuilderBlade','NotableQueriesBuilderBlade')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"Session Query List",
                              "newGroup":false,
                              "preselectedFilters":"Type, Computer",
                              "renderMode":"grid"
                           },
                           "queries":[
                              {
                                 "query":"ITPC_CTX_Session_CL | sort by TimeGenerated desc, UserName_s asc",
                                 "displayName":"Connection List"
                              },
                              {
                                 "query":"ITPC_CTX_Session_CL | distinct ClientName_s",
                                 "displayName":"Client Station Names"
                              },
                              {
                                 "query":"ITPC_CTX_PerfData_CL | where Category == \"RemoteFX Network\" and Counter_s == \"Total Sent Rate\" and UserName_s == \"mmeurer\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, 30m) | sort by TimeGenerated desc",
                                 "displayName":"Session Output Bandwidth for a specific User"
                              },
                              {
                                 "query":"ITPC_CTX_PerfData_CL | where Category == \"RemoteFX Network\" and Counter_s == \"Current TCP RTT\" and UserName_s == \"mmeurer\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, 30m) | sort by TimeGenerated desc",
                                 "displayName":"Session RTT for a specific User"
                              }
                           ]
                        }
                     }
                  ],
                  "OverviewTile":{
                     "Id": "[if(equals('1', '1'),'SingleQueryDonutBuilderTileV1','SingleQueryDonutBuilderTileV1')]",
                     "Type":"OverviewTile",
                     "Version":2,
                     "Configuration":{
                        "Donut":{
                           "Query":"ITPC_CTX_Session_CL | summarize AggregatedValue = dcount(SessionHash_s) by ConnectionState_s | sort by AggregatedValue desc",
                           "CenterLegend":{
                              "Text":"Active",
                              "Operation":"Sum",
                              "ArcsToSelect":[
                                 "Active"
                              ]
                           },
                           "Options":{
                              "colors":[
                                 "#00188f",
                                 "#0072c6",
                                 "#00bcf2"
                              ]
                           }
                        },
                        "Advanced":{
                           "DataFlowVerification":{
                              "Enabled":false,
                              "Query":"search *"
                           }
                        }
                     }
                  }
               }
            },
            {
               "apiVersion":"2020-03-01-preview",
               "name":"WVD Site and Applications",
               "type":"views",
               "location":"[parameters('location')]",
               "id":"[resourceId('Microsoft.OperationalInsights/workspaces/views', concat(parameters('workspace'),'-', uniqueString(resourceGroup().id,subscription().subscriptionId)),'WVD Site and Applications')]",
               "dependson":[
                  "[resourceId('Microsoft.OperationalInsights/workspaces', concat(parameters('workspace'),'-', uniqueString(resourceGroup().id,subscription().subscriptionId)))]"
               ],
               "properties":{
                  "id":"[resourceId('Microsoft.OperationalInsights/workspaces/views', concat(parameters('workspace'),'-', uniqueString(resourceGroup().id,subscription().subscriptionId)),'WVD Site and Applications')]",
                  "Name":"WVD Site and Applications",
                  "Author":"marcel.meurer@sepago.de",
                  "Source":"Local",
                  "Version":2,
                  "Dashboard":[
                     {
                        "Id": "[if(equals('1', '1'),'NumberTileListBuilderBlade','NumberTileListBuilderBlade')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"WVD Host Pool",
                              "newGroup":true,
                              "useIcon":false
                           },
                           "Tile":{
                              "Legend":"Unique User",
                              "Query":"ITPC_CTX_Session_CL | distinct UserName_s| where UserName_s !=\"\"| count"
                           },
                           "List":{
                              "Query":"ITPC_CTX_Session_CL | where UserName_s !=\"\" | summarize Count = dcount(UserName_s) by DesktopGroup_s",
                              "HideGraph":false,
                              "enableSparklines":true,
                              "ColumnsTitle":{
                                 "Name":"DesktopGroup",
                                 "Value":"Count"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":false,
                                 "values":[
                                    {
                                       "name":"Normal",
                                       "threshold":"Default",
                                       "color":"#009e49",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"60",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"90",
                                       "color":"#ba141a",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search {selected item} | sort by TimeGenerated desc",
                              "NavigationSelect":{
                                 "NavigationQuery":"search {selected item} | sort by TimeGenerated desc"
                              }
                           }
                        }
                     },
                     {
                        "Id": "[if(equals('1', '1'),'NumberTileListBuilderBlade','NumberTileListBuilderBlade')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"Applications",
                              "newGroup":true,
                              "useIcon":false
                           },
                           "Tile":{
                              "Query":"ITPC_CTX_Application_CL | where Event_s == \"crashed\" | summarize AggregatedValue = count() by Name_s\r\n| count",
                              "Legend":"Application Crashed"
                           },
                           "List":{
                              "Query":"ITPC_CTX_Application_CL | where Event_s == \"crashed\" | summarize AggregatedValue = count() by Name_s",
                              "HideGraph":false,
                              "enableSparklines":true,
                              "operation":"Summary",
                              "ColumnsTitle":{
                                 "Name":"Application",
                                 "Value":"Count"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":false,
                                 "values":[
                                    {
                                       "name":"Normal",
                                       "threshold":"Default",
                                       "color":"#009e49",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"60",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"90",
                                       "color":"#ba141a",
                                       "isDefault":false
                                    }
                                 ]
                              }
                           }
                        }
                     },
                     {
                        "Id": "[if(equals('1', '1'),'SingleQueryDonutBuilderTileV1','SingleQueryDonutBuilderTileV1')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"Application by User",
                              "newGroup":true,
                              "useIcon":false
                           },
                           "Header":{
                              "Title":"Processor usage",
                              "Subtitle":"%"
                           },
                           "LineChart":{
                              "Query":"ITPC_CTX_PerfData_CL | where Category == \"Processor Information\" and Counter_s == \"% Processor Time\" | summarize AggregatedValue = avg(value_d) by Worker_s",
                              "yAxis":{
                                 "isLogarithmic":false
                              }
                           },
                           "List":{
                              "Query":"ITPC_CTX_Process_CL | where UserName_s !=\"\" | summarize AggregatedValue = avg(PercentProcessorTime_d) by UserName_s, Worker_s, Name_s",
                              "HideGraph":false,
                              "enableSparklines":true,
                              "operation":"Summary",
                              "ColumnsTitle":{
                                 "Name":"Username",
                                 "Value":"%"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":false,
                                 "values":[
                                    {
                                       "name":"Normal",
                                       "threshold":"Default",
                                       "color":"#009e49",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"60",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"90",
                                       "color":"#ba141a",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search in (ITPC_CTX_Process_CL) {selected item} | summarize AggregatedValue = max(PercentProcessorTime_d) by UserName_s, Worker_s, Name_s, bin(TimeGenerated, 1h) | sort by TimeGenerated desc | render timechart"
                           }
                        }
                     },
                     {
                        "Id": "[if(equals('1', '1'),'SingleQueryDonutBuilderTileV1','SingleQueryDonutBuilderTileV1')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"Application by User",
                              "newGroup":false,
                              "useIcon":false
                           },
                           "Header":{
                              "Title":"Memory available",
                              "Subtitle":"Byte"
                           },
                           "LineChart":{
                              "Query":"ITPC_CTX_PerfData_CL | where Category == \"Memory\" and Counter_s == \"Available Bytes\" | summarize AggregatedValue = avg(value_d) by Worker_s",
                              "yAxis":{
                                 "isLogarithmic":false
                              }
                           },
                           "List":{
                              "Query":"ITPC_CTX_Process_CL | where UserName_s !=\"\" | summarize AggregatedValue = avg(WorkingSet_d) by UserName_s, Worker_s, Name_s",
                              "HideGraph":false,
                              "enableSparklines":true,
                              "operation":"Summary",
                              "ColumnsTitle":{
                                 "Name":"Username",
                                 "Value":"Byte"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":false,
                                 "values":[
                                    {
                                       "name":"Normal",
                                       "threshold":"Default",
                                       "color":"#009e49",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"60",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"90",
                                       "color":"#ba141a",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search in (ITPC_CTX_Process_CL) {selected item} | summarize AggregatedValue = max(WorkingSet_d) by UserName_s, Worker_s, Name_s, bin(TimeGenerated, 1h) | sort by TimeGenerated desc | render timechart"
                           }
                        }
                     },
                     {
                        "Id": "[if(equals('1', '1'),'SingleQueryDonutBuilderBladeV1','SingleQueryDonutBuilderBladeV1')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"Application Overall Consumption",
                              "newGroup":true,
                              "useIcon":false
                           },
                           "Header":{
                              "Title":"Processor Consumption",
                              "Subtitle":"Shared Ticks"
                           },
                           "Donut":{
                              "Query":"ITPC_CTX_Process_CL | where Name_s != \"System Idle Process\" | summarize AggregatedValue = sum(PercentProcessorTime_d) by Name_s | sort by AggregatedValue desc",
                              "CenterLegend":{
                                 "Text":"Total",
                                 "Operation":"Sum"
                              },
                              "Options":{
                                 "colors":[
                                    "#00188f",
                                    "#0072c6",
                                    "#00bcf2"
                                 ]
                              }
                           },
                           "List":{
                              "Query":"ITPC_CTX_Process_CL | where UserName_s !=\"\"  and Name_s != \"System Idle Process\" | summarize AggregatedValue = sum(PercentProcessorTime_d) by Name_s",
                              "HideGraph":false,
                              "enableSparklines":false,
                              "operation":"Summary",
                              "ColumnsTitle":{
                                 "Name":"Process",
                                 "Value":"S-Ticks"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":false,
                                 "values":[
                                    {
                                       "name":"Normal",
                                       "threshold":"Default",
                                       "color":"#009e49",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"60",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"90",
                                       "color":"#ba141a",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search in (ITPC_CTX_Process_CL) {selected item} and Name_s != \"System Idle Process\" | summarize AggregatedValue = sum(PercentProcessorTime_d) by UserName_s"
                           }
                        }
                     },
                     {
                        "Id": "[if(equals('1', '1'),'SingleQueryDonutBuilderBladeV1','SingleQueryDonutBuilderBladeV1')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"Application Overall Consumption",
                              "newGroup":false,
                              "useIcon":false
                           },
                           "Header":{
                              "Title":"Memory Consumption",
                              "Subtitle":"Memory Ticks"
                           },
                           "Donut":{
                              "Query":"ITPC_CTX_Process_CL | where Name_s != \"System Idle Process\" | extend WorkingSetN = (WorkingSet_d * 0.0000000001) | summarize AggregatedValue = sum(WorkingSetN) by Name_s | sort by AggregatedValue desc",
                              "CenterLegend":{
                                 "Text":"Total",
                                 "Operation":"Sum"
                              },
                              "Options":{
                                 "colors":[
                                    "#00188f",
                                    "#0072c6",
                                    "#00bcf2"
                                 ]
                              }
                           },
                           "List":{
                              "Query":"ITPC_CTX_Process_CL | where UserName_s !=\"\"  and Name_s != \"System Idle Process\" | extend WorkingSetN = (WorkingSet_d * 0.0000000001) | summarize AggregatedValue = sum(WorkingSetN) by Name_s",
                              "HideGraph":false,
                              "enableSparklines":false,
                              "operation":"Summary",
                              "ColumnsTitle":{
                                 "Name":"Process",
                                 "Value":"M-nTicks"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":false,
                                 "values":[
                                    {
                                       "name":"Normal",
                                       "threshold":"Default",
                                       "color":"#009e49",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"60",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"90",
                                       "color":"#ba141a",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search in (ITPC_CTX_Process_CL) {selected item} and Name_s != \"System Idle Process\" | extend WorkingSetN = (WorkingSet_d * 0.0000000001) | summarize AggregatedValue = sum(WorkingSetN) by UserName_s"
                           }
                        }
                     },
                     {
                        "Id": "[if(equals('1', '1'),'SingleQueryDonutBuilderBladeV1','SingleQueryDonutBuilderBladeV1')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"User Overall Consumption",
                              "newGroup":true,
                              "useIcon":false
                           },
                           "Header":{
                              "Title":"Processor Consumption",
                              "Subtitle":"Shared Ticks"
                           },
                           "Donut":{
                              "Query":"ITPC_CTX_Process_CL | where UserName_s !=\"\"  and Name_s != \"System Idle Process\" | summarize AggregatedValue = sum(PercentProcessorTime_d) by UserName_s | sort by AggregatedValue desc",
                              "CenterLegend":{
                                 "Text":"Total",
                                 "Operation":"Sum"
                              },
                              "Options":{
                                 "colors":[
                                    "#00188f",
                                    "#0072c6",
                                    "#00bcf2"
                                 ]
                              }
                           },
                           "List":{
                              "Query":"ITPC_CTX_Process_CL | where UserName_s !=\"\"  and Name_s != \"System Idle Process\" | summarize AggregatedValue = sum(PercentProcessorTime_d) by UserName_s",
                              "HideGraph":false,
                              "enableSparklines":false,
                              "operation":"Summary",
                              "ColumnsTitle":{
                                 "Name":"User",
                                 "Value":"S-Ticks"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":false,
                                 "values":[
                                    {
                                       "name":"Normal",
                                       "threshold":"Default",
                                       "color":"#009e49",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"60",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"90",
                                       "color":"#ba141a",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search in (ITPC_CTX_Process_CL) {selected item} and Name_s != \"System Idle Process\" | summarize AggregatedValue = sum(PercentProcessorTime_d) by Name_s"
                           }
                        }
                     },
                     {
                        "Id": "[if(equals('1', '1'),'SingleQueryDonutBuilderBladeV1','SingleQueryDonutBuilderBladeV1')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"USER OVERALL CONSUMPTION",
                              "newGroup":false,
                              "useIcon":false
                           },
                           "Header":{
                              "Title":"User Consumption",
                              "Subtitle":"Memory Ticks"
                           },
                           "Donut":{
                              "Query":"ITPC_CTX_Process_CL | where UserName_s !=\"\" and Name_s != \"System Idle Process\" | extend WorkingSetN = (WorkingSet_d * 0.0000000001) | summarize AggregatedValue = sum(WorkingSetN) by UserName_s | sort by AggregatedValue desc",
                              "CenterLegend":{
                                 "Text":"Total",
                                 "Operation":"Sum"
                              },
                              "Options":{
                                 "colors":[
                                    "#00188f",
                                    "#0072c6",
                                    "#00bcf2"
                                 ]
                              }
                           },
                           "List":{
                              "Query":"ITPC_CTX_Process_CL | where UserName_s !=\"\" and Name_s != \"System Idle Process\" | extend WorkingSetN = (WorkingSet_d * 0.0000000001) | summarize AggregatedValue = sum(WorkingSetN) by UserName_s",
                              "HideGraph":false,
                              "enableSparklines":false,
                              "operation":"Summary",
                              "ColumnsTitle":{
                                 "Name":"User",
                                 "Value":"M-Ticks"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":false,
                                 "values":[
                                    {
                                       "name":"Normal",
                                       "threshold":"Default",
                                       "color":"#009e49",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"60",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"90",
                                       "color":"#ba141a",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search in (ITPC_CTX_Process_CL) {selected item} and Name_s != \"System Idle Process\" | extend WorkingSetN = (WorkingSet_d * 0.0000000001) | summarize AggregatedValue = sum(WorkingSetN) by Name_s"
                           }
                        }
                     }
                  ],
                  "OverviewTile":{
                     "Id": "[if(equals('1', '1'),'SingleNumberBuilderTile','SingleNumberBuilderTile')]",
                     "Type":"OverviewTile",
                     "Version":2,
                     "Configuration":{
                        "Tile":{
                           "Legend":"Unique Users",
                           "Query":"ITPC_CTX_Process_CL | where UserName_s !=\"\" | distinct UserName_s| count"
                        },
                        "Advanced":{
                           "DataFlowVerification":{
                              "Enabled":false,
                              "Query":"search *"
                           }
                        }
                     }
                  }
               }
            },
            {
               "apiVersion":"2020-03-01-preview",
               "name":"WVD Session Hosts",
               "type":"views",
               "location":"[parameters('location')]",
               "id":"[resourceId('Microsoft.OperationalInsights/workspaces/views', concat(parameters('workspace'),'-', uniqueString(resourceGroup().id,subscription().subscriptionId)),'WVD Session Hosts')]",
               "dependson":[
                  "[resourceId('Microsoft.OperationalInsights/workspaces', concat(parameters('workspace'),'-', uniqueString(resourceGroup().id,subscription().subscriptionId)))]"
               ],
               "properties":{
                  "id":"[resourceId('Microsoft.OperationalInsights/workspaces/views', concat(parameters('workspace'),'-', uniqueString(resourceGroup().id,subscription().subscriptionId)),'WVD Session Hosts')]",
                  "Name":"WVD Session Hosts",
                  "Author":"marcel.meurer@sepago.de",
                  "Source":"Local",
                  "Version":2,
                  "Dashboard":[
                     {
                        "Id": "[if(equals('1', '1'),'LineChartCalloutBuilderBlade','LineChartCalloutBuilderBlade')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"CPU Consumption",
                              "newGroup":false,
                              "useIcon":false
                           },
                           "Header":{
                              "Title":"Overall CPU Consumption",
                              "Subtitle":"%"
                           },
                           "LineChart":{
                              "Query":"ITPC_CTX_PerfData_CL | where Category == \"Processor Information\" and Counter_s == \"% Processor Time\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, 1h) | sort by TimeGenerated desc | render timechart",
                              "Callout":{
                                 "Title":"Avg",
                                 "Operation":"Average"
                              },
                              "yAxis":{
                                 "isLogarithmic":false
                              }
                           },
                           "List":{
                              "Query":"ITPC_CTX_PerfData_CL | where Category == \"Processor Information\" and Counter_s == \"% Processor Time\" | summarize AggregatedValue = avg(value_d) by Worker_s | sort by Worker_s asc",
                              "HideGraph":false,
                              "enableSparklines":true,
                              "operation":"Summary",
                              "ColumnsTitle":{
                                 "Name":"Worker",
                                 "Value":"%"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":true,
                                 "values":[
                                    {
                                       "name":"Normal",
                                       "threshold":"Default",
                                       "color":"#009e49",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"85",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"92",
                                       "color":"#ba141a",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search {selected item} | sort by TimeGenerated desc",
                              "NavigationSelect":{
                                 "NavigationQuery":"search {selected item} | sort by TimeGenerated desc"
                              }
                           }
                        }
                     },
                     {
                        "Id": "[if(equals('1', '1'),'LineChartCalloutBuilderBlade','LineChartCalloutBuilderBlade')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"Memory Consumption",
                              "newGroup":false,
                              "useIcon":false
                           },
                           "Header":{
                              "Title":"Memory free",
                              "Subtitle":"Availaible bytes"
                           },
                           "LineChart":{
                              "Query":"ITPC_CTX_PerfData_CL | where Category == \"Memory\" and Counter_s == \"Available Bytes\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, 1h) | sort by TimeGenerated desc | render timechart",
                              "Callout":{
                                 "Title":"Avg",
                                 "Operation":"Average"
                              },
                              "yAxis":{
                                 "isLogarithmic":false
                              }
                           },
                           "List":{
                              "Query":"ITPC_CTX_PerfData_CL | where Category == \"Memory\" and Counter_s == \"Available Bytes\" | summarize AggregatedValue = avg(value_d) by Worker_s | sort by Worker_s asc",
                              "HideGraph":false,
                              "enableSparklines":true,
                              "operation":"Summary",
                              "ColumnsTitle":{
                                 "Name":"Worker",
                                 "Value":"Bytes free"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":true,
                                 "values":[
                                    {
                                       "name":"Error",
                                       "threshold":"Default",
                                       "color":"#ba141a",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"100000000",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Normal",
                                       "threshold":"1000000000",
                                       "color":"#009e49",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search in (ITPC_CTX_Process_CL) {selected item} and Name_s != \"System Idle Process\" | summarize Memory_Byte = avg(WorkingSet_d) by Name_s, bin(TimeGenerated, 1h) | sort by TimeGenerated desc | render timechart"
                           }
                        }
                     },
                     {
                        "Id": "[if(equals('1', '1'),'LineChartCalloutBuilderBlade','LineChartCalloutBuilderBlade')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"Network",
                              "newGroup":false,
                              "useIcon":false
                           },
                           "Header":{
                              "Title":"Network Throughput",
                              "Subtitle":"byte/s"
                           },
                           "LineChart":{
                              "Query":"ITPC_CTX_PerfData_CL | where Category == \"Network Adapter\" and Counter_s == \"Bytes Total/sec\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, 1h) | sort by TimeGenerated desc | render timechart",
                              "Callout":{
                                 "Title":"Avg",
                                 "Operation":"Average"
                              },
                              "yAxis":{
                                 "isLogarithmic":false
                              }
                           },
                           "List":{
                              "Query":"ITPC_CTX_PerfData_CL | where Category == \"Network Adapter\" and Counter_s == \"Bytes Total/sec\" | summarize AggregatedValue = avg(value_d) by Worker_s",
                              "HideGraph":false,
                              "enableSparklines":true,
                              "operation":"Summary",
                              "ColumnsTitle":{
                                 "Name":"Worker",
                                 "Value":"byte/s"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":true,
                                 "values":[
                                    {
                                       "name":"Normal",
                                       "threshold":"Default",
                                       "color":"#009e49",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"2000000",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"10000000",
                                       "color":"#ba141a",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search in (ITPC_CTX_Process_CL) {selected item} and Name_s != \"System Idle Process\" | summarize IO_BpS = avg(IODataBytesPersec_d) by Name_s, bin(TimeGenerated, 1h) | sort by TimeGenerated desc | render timechart"
                           }
                        }
                     },
                     {
                        "Id": "[if(equals('1', '1'),'LineChartCalloutBuilderBlade','LineChartCalloutBuilderBlade')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"Processor Queue",
                              "newGroup":false,
                              "useIcon":false
                           },
                           "Header":{
                              "Title":"Length",
                              "Subtitle":"#"
                           },
                           "LineChart":{
                              "Query":"ITPC_CTX_PerfData_CL | where Category == \"System\" and Counter_s == \"Processor Queue Length\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, 1h) | sort by TimeGenerated desc | render timechart",
                              "Callout":{
                                 "Title":"Avg",
                                 "Operation":"Average"
                              },
                              "yAxis":{
                                 "isLogarithmic":false
                              }
                           },
                           "List":{
                              "Query":"ITPC_CTX_PerfData_CL | where Category == \"System\" and Counter_s == \"Processor Queue Length\" | summarize AggregatedValue = avg(value_d) by Worker_s | sort by Worker_s asc",
                              "HideGraph":false,
                              "enableSparklines":true,
                              "operation":"Summary",
                              "ColumnsTitle":{
                                 "Name":"Worker",
                                 "Value":"#"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":true,
                                 "values":[
                                    {
                                       "name":"Normal",
                                       "threshold":"Default",
                                       "color":"#009e49",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"6",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"12",
                                       "color":"#ba141a",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search in (ITPC_CTX_Process_CL) {selected item} and Name_s != \"System Idle Process\" | summarize CPU_Perc = avg(PercentProcessorTime_d), Mem_Byte = avg(WorkingSet_d) by Name_s"
                           }
                        }
                     },
                     {
                        "Id": "[if(equals('1', '1'),'LineChartCalloutBuilderBlade','LineChartCalloutBuilderBlade')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"Disk Queue",
                              "newGroup":false,
                              "useIcon":false
                           },
                           "Header":{
                              "Title":"Length",
                              "Subtitle":"#"
                           },
                           "LineChart":{
                              "Query":"ITPC_CTX_PerfData_CL | where Category == \"PhysicalDisk\" and Counter_s == \"Avg. Disk Queue Length\" and Instance_s == \"_Total\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, 1h) | sort by TimeGenerated desc | render timechart",
                              "Callout":{
                                 "Title":"Avg",
                                 "Operation":"Average"
                              },
                              "yAxis":{
                                 "isLogarithmic":false
                              }
                           },
                           "List":{
                              "Query":"ITPC_CTX_PerfData_CL | where Category == \"PhysicalDisk\" and Counter_s == \"Avg. Disk Queue Length\" and Instance_s == \"_Total\" | summarize AggregatedValue = avg(value_d) by Worker_s | sort by Worker_s asc",
                              "HideGraph":false,
                              "enableSparklines":true,
                              "operation":"Summary",
                              "ColumnsTitle":{
                                 "Name":"Worker",
                                 "Value":"#"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":true,
                                 "values":[
                                    {
                                       "name":"Normal",
                                       "threshold":"Default",
                                       "color":"#009e49",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"0.8",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"1.8",
                                       "color":"#ba141a",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search in (ITPC_CTX_Process_CL) {selected item} and Name_s != \"System Idle Process\" | summarize IO_BpS = avg(IODataBytesPersec_d) by Name_s, bin(TimeGenerated, 1h) | sort by TimeGenerated desc | render timechart"
                           }
                        }
                     },
                     {
                        "Id": "[if(equals('1', '1'),'LineChartCalloutBuilderBlade','LineChartCalloutBuilderBlade')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"Paging File",
                              "newGroup":false,
                              "useIcon":false
                           },
                           "Header":{
                              "Title":"Usage",
                              "Subtitle":"%"
                           },
                           "LineChart":{
                              "Query":"ITPC_CTX_PerfData_CL | where Category == \"Paging File\" and Counter_s == \"% Usage\" and Instance_s == \"_Total\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, 1h) | sort by TimeGenerated desc | render timechart",
                              "Callout":{
                                 "Title":"Avg",
                                 "Operation":"Average"
                              },
                              "yAxis":{
                                 "isLogarithmic":false
                              }
                           },
                           "List":{
                              "Query":"ITPC_CTX_PerfData_CL | where Category == \"Paging File\" and Counter_s == \"% Usage\" and Instance_s == \"_Total\" | summarize AggregatedValue = avg(value_d) by Worker_s | sort by Worker_s asc",
                              "HideGraph":false,
                              "enableSparklines":true,
                              "operation":"Summary",
                              "ColumnsTitle":{
                                 "Name":"Worker",
                                 "Value":"%"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":true,
                                 "values":[
                                    {
                                       "name":"Normal",
                                       "threshold":"Default",
                                       "color":"#009e49",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"70",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"90",
                                       "color":"#ba141a",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search {selected item}"
                           }
                        }
                     },
                     {
                        "Id": "[if(equals('1', '1'),'NumberTileListBuilderBlade','NumberTileListBuilderBlade')]",
                        "Type":"Blade",
                        "Version":0,
                        "Configuration":{
                           "General":{
                              "title":"Desktop Groups",
                              "newGroup":false,
                              "useIcon":false
                           },
                           "Tile":{
                              "Legend":"Worker Count",
                              "Query":"ITPC_CTX_PerfData_CL | distinct Worker_s| count"
                           },
                           "List":{
                              "Query":"ITPC_CTX_PerfData_CL | summarize AggregatedValue = dcount(Worker_s) by DesktopGroup_s",
                              "HideGraph":false,
                              "enableSparklines":true,
                              "ColumnsTitle":{
                                 "Name":"DesktopGroup",
                                 "Value":"#"
                              },
                              "Color":"#0072c6",
                              "thresholds":{
                                 "isEnabled":false,
                                 "values":[
                                    {
                                       "name":"Normal",
                                       "threshold":"Default",
                                       "color":"#009e49",
                                       "isDefault":true
                                    },
                                    {
                                       "name":"Warning",
                                       "threshold":"60",
                                       "color":"#fcd116",
                                       "isDefault":false
                                    },
                                    {
                                       "name":"Error",
                                       "threshold":"90",
                                       "color":"#ba141a",
                                       "isDefault":false
                                    }
                                 ]
                              },
                              "NavigationQuery":"search {selected item} | sort by TimeGenerated desc",
                              "NavigationSelect":{
                                 "NavigationQuery":"search {selected item} | sort by TimeGenerated desc"
                              }
                           }
                        }
                     }
                  ],
                  "OverviewTile":{
                     "Id": "[if(equals('1', '1'),'SingleNumberBuilderTile','SingleNumberBuilderTile')]",
                     "Type":"OverviewTile",
                     "Version":2,
                     "Configuration":{
                        "Tile":{
                           "Legend":"Are reporting to Log Analytics",
                           "Query":"ITPC_CTX_PerfData_CL | where Worker_s!=\"\" | distinct Worker_s| count"
                        },
                        "Advanced":{
                           "DataFlowVerification":{
                              "Enabled":true,
                              "Query":"ITPC_CTX_PerfData_CL | count",
                              "Message":"There are no data at this time. Make sure that you have installed the agents (http://loganalytics.sepago.com).\n\nKeep in mind that after the first time data arrived to Log Analytics it takes some time (up to hours) to build the data scheme."
                           }
                        }
                     }
                  }
               }
            }
         ]
      },
	 {
		"name": "f3c02d9d-aab8-43b6-9eb8-17ae3dfc11ad",
		"type": "microsoft.insights/workbooktemplates",
		"location": "[resourceGroup().location]",
		"apiVersion": "2019-10-17-preview",
		"dependsOn": [],
		"properties": {
			"galleries": [
				{
					"name": "WVD Insights",
					"category": "Windows Virtual Desktop",
					"order": 100,
					"type": "workbook",
					"resourceType": "microsoft.operationalinsights/workspaces"
				}
			],
			"templateData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Windows Virtual Desktop Overview Workbook\"},\"customWidth\":\"80\",\"name\":\"text - 0\"},{\"type\":1,\"content\":{\"json\":\"[![sepago GmbH - Germany](https://sepago.blob.core.windows.net/public/images/sepago.logo.png)](https://www.sepago.com)\"},\"customWidth\":\"20\",\"name\":\"text - 1\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"6a35dc35-14fe-4877-88ca-55047ca82196\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_showLicense\",\"type\":1,\"description\":\"If \\\"false\\\" the licensing tile is hidden\",\"value\":\"true\",\"isHiddenWhenLocked\":true,\"resourceType\":\"microsoft.insights/components\"},{\"id\":\"f1363193-d7e7-4724-a946-136fa480ecd2\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_defaultAggBin\",\"type\":1,\"description\":\"Default aggretgation time for operations (normally 10m)\",\"value\":\"10m\",\"isHiddenWhenLocked\":true,\"timeContextFromParameter\":\"TimeRange\",\"resourceType\":\"microsoft.insights/components\"},{\"id\":\"411f8853-3954-47d7-a645-cd371595ca0f\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_ignoreHostPools4Licensing\",\"type\":1,\"description\":\"Users using this host pools are not summarized to calculate the license count: ['STAGING', 'DEMO']\",\"value\":\"['STAGING', 'DEMO']\",\"isHiddenWhenLocked\":true,\"resourceType\":\"microsoft.insights/components\"},{\"id\":\"390686f3-8df6-4120-8be5-422f4905e353\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"_ignorePathAndApps\",\"type\":1,\"description\":\"Prevent showing applications containing this entries in theire path in application summaries.\",\"value\":\"['C:\\\\\\\\Windows\\\\\\\\system32\\\\\\\\','C:\\\\\\\\Program Files\\\\\\\\Citrix\\\\\\\\Personal vDisk\\\\\\\\','C:\\\\\\\\Program Files (x86)\\\\\\\\Citrix\\\\\\\\','WindowsInternal','csrss.exe','SearchUI.exe']\",\"isHiddenWhenLocked\":true,\"resourceType\":\"microsoft.insights/components\"}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.insights/components\"},\"name\":\"parameters - 45\"},{\"type\":1,\"content\":{\"json\":\"## Current status of your WVD environment\\r\\n\\r\\n### The following tiles show the active sessions, disconnected sessions, and the number of active session hosts by host pool name. All session hosts running the Azure Monitor for WVD Agent sending data to this Log Analytics workspace. \"},\"customWidth\":\"80\",\"name\":\"text - 9\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let _ignoreHostPools4Licensing=dynamic({_ignoreHostPools4Licensing});\\r\\nITPC_CTX_Session_CL | where TimeGenerated > startofmonth(ago(180d)) and TimeGenerated< startofmonth(now()) and  DesktopGroup_s !in (_ignoreHostPools4Licensing) | extend YearMonth=strcat(getyear(TimeGenerated),\\\".\\\",getmonth(TimeGenerated)) | summarize DistinctUsers=dcount(UserName_s) by YearMonth, WorkspaceId=TenantId | order by YearMonth desc | take 1| extend Send=strcat(\\\"https://csp-productscallback-prd.azurewebsites.net/api/Send2LogAnalytics?code=MW/lpAE5R5e8PvyxTFXsbDhxLGUkBauVtucx7a4Tnc0KERG/na3PAQ==&WorkspaceId=\\\",WorkspaceId,\\\"&YearMonth=\\\",YearMonth,\\\"&DistinctUsers=\\\",DistinctUsers)\",\"size\":4,\"title\":\"License information\",\"exportFieldName\":\"UserName\",\"exportParameterName\":\"_UserName\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Send\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Send to sepago to change license count for this month\",\"showIcon\":true}}]},\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"YearMonth\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true},\"tooltipFormat\":{\"tooltip\":\"Year.Month for the report\"}},\"leftContent\":{\"columnMatch\":\"DistinctUsers\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}},\"tooltipFormat\":{\"tooltip\":\"Count of licenses used for the last month\"}},\"secondaryContent\":{\"columnMatch\":\"Send\",\"formatter\":7,\"formatOptions\":{\"linkTarget\":\"Url\",\"linkLabel\":\"Send to sepago\",\"showIcon\":true},\"tooltipFormat\":{\"tooltip\":\"Send the distinct user count for the last month to sepago to correct billing. Do this in the first five days of a month to correct the number for the last month. Only the workspace id, date, and distinct user count are submitted. Your workspace must be registered to match (send the workspace id to sales@sepago.de).\"}},\"showBorder\":false,\"rowLimit\":1}},\"customWidth\":\"20\",\"conditionalVisibility\":{\"parameterName\":\"_showLicense\",\"comparison\":\"isNotEqualTo\",\"value\":\"false\"},\"name\":\"query - 3\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Session_CL| where TimeGenerated > ago(5m) \\r\\n| summarize SessionHostActive=dcount(Worker_s), Sessions=dcount(SessionHash_s),SessionsDisconnected=dcountif(SessionHash_s,ConnectionState_s==\\\"Disconnected\\\"),SessionsActive=dcountif(SessionHash_s,ConnectionState_s!=\\\"Disconnected\\\") by HostPool=DesktopGroup_s\",\"size\":4,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"HostPool\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"SessionsActive\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}},\"tooltipFormat\":{\"tooltip\":\"Active sessions\"}},\"rightContent\":{\"columnMatch\":\"SessionsDisconnected\",\"formatOptions\":{\"showIcon\":true},\"tooltipFormat\":{\"tooltip\":\"Disconnected sessions\"}},\"secondaryContent\":{\"columnMatch\":\"SessionHostActive\",\"formatOptions\":{\"showIcon\":true},\"tooltipFormat\":{\"tooltip\":\"Active session hosts\"}},\"showBorder\":true},\"chartSettings\":{\"yAxis\":[\"SessionsActiveMax\"],\"group\":\"HostPool\",\"createOtherGroup\":null,\"showLegend\":true}},\"name\":\"query - 5\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Sessions\",\"subTarget\":\"Sessions\",\"style\":\"link\"},{\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Session hosts\",\"subTarget\":\"SessionHosts\",\"style\":\"link\"},{\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Processes\",\"subTarget\":\"Processes\",\"style\":\"link\"},{\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Applications and users\",\"subTarget\":\"Applications\",\"style\":\"link\"}]},\"name\":\"lnkMainSelector\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"88bda73f-158a-4971-9310-1e557a8f89f0\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"label\":\"Time Range\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":2592000000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":900000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"resourceType\":\"microsoft.insights/components\"},{\"id\":\"6e7ddca7-163c-4547-9e37-d408299ce828\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"HostPool\",\"label\":\"Host Pool\",\"type\":2,\"description\":\"Select a host pool to show only data of this specific one\",\"isRequired\":true,\"query\":\"ITPC_CTX_Process_CL | distinct DesktopGroup_s | order by HostPool=DesktopGroup_s\",\"value\":\"WVD.DESIGN2.VDI-V2\",\"typeSettings\":{\"additionalResourceOptions\":[]},\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"}],\"style\":\"pills\",\"doNotRunWhenHidden\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - 2\"},{\"type\":1,\"content\":{\"json\":\"## Sessions\\r\\nThe session tab shows information and data around the user sessions. This contains bandwidths, latencies and more grouped by different elements.\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},\"name\":\"text - 16\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Session_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" | summarize dcount(SessionHash_s) by ConnectionState_s, bin(TimeGenerated, {_defaultAggBin})\",\"size\":0,\"title\":\"Active and disconnected sessions\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\",\"chartSettings\":{\"showMetrics\":false,\"showLegend\":true}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},\"name\":\"query - 11\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Session_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\"|summarize Minutes=count() by User=UserName_s, SessionHash_s| summarize Distinct_Sessions=dcount(SessionHash_s),Sum_SessionDurationInMinutes=sum(Minutes).toint(), Avg_SessionDurationInMinutes=avg(Minutes).toint(),Min_SessionDurationInMinutes=min(Minutes).toint(),Max_SessionDurationInMinutes=max(Minutes).toint() by User\\r\\n| order by Distinct_Sessions desc\",\"size\":0,\"title\":\"User sessions and runtime - ordery by distinct sessions\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},\"name\":\"query - 7\"},{\"type\":1,\"content\":{\"json\":\"## Bandwidth and latency\\r\\nBandwidths and latencies the essential metrics indicating an excellent or poor user experience. Typical output bandwidths area between 30kbit/s and several MBit/s depending on the application the users use. If users using browsers, the MBit/s are normal. Latency is a clear indicator of a good experience. The latency should not be higher than hundreds of ms.\\r\\n\\r\\nPart of a Service Level Agreement (SLA) can be the bandwidth and latency. In this case, it's more a trigger for an administrator to check if the network connections have some issues, or to find out what kind of applications requires a high bandwidth usage. \"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},\"name\":\"text - 17\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (Category == \\\"ICA Session\\\" or Category == \\\"RemoteFX Network\\\") and (Counter_s == \\\"Output Session Bandwidth\\\" or Counter_s == \\\"Total Sent Rate\\\") and Instance_s != \\\"_Server Total\\\" | summarize AggregatedValueS1 = avg(value_d) by UserName_s, bin(TimeGenerated, 3m) | where AggregatedValueS1>8388608 | summarize Count=count() by UserName_s | order by Count desc\",\"size\":0,\"aggregation\":3,\"title\":\"Infringement of SLA: Output bandwidth >8MBits/s over 3 minutes (#)\",\"noDataMessage\":\"No infringement of this SLA in the selected time-frame\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},\"name\":\"query - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (Category == \\\"ICA Session\\\" or Category == \\\"RemoteFX Network\\\") and (Counter_s == \\\"Latency - Last Recorded\\\" or Counter_s == \\\"Current TCP RTT\\\") and Instance_s != \\\"_Server Total\\\" | summarize AggregatedValueS1 = avg(value_d) by UserName_s, bin(TimeGenerated, 3m) | where AggregatedValueS1>200 | summarize Count=count() by UserName_s | order by Count desc\",\"size\":0,\"aggregation\":3,\"title\":\"Infringement of SLA: Latency/RTT>200 ms over 3 minutes (#)\",\"noDataMessage\":\"No infringement of this SLA in the selected time-frame\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},\"name\":\"query - 13\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (Category == \\\"ICA Session\\\" or Category == \\\"RemoteFX Network\\\") and (Counter_s == \\\"Output Session Bandwidth\\\" or Counter_s == \\\"Total Sent Rate\\\") and Instance_s != \\\"_Server Total\\\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, {_defaultAggBin})\",\"size\":0,\"aggregation\":3,\"title\":\"Average output bandwidth by session host (bit/s)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\",\"chartSettings\":{}},\"customWidth\":\"35\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},\"name\":\"query - 14\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (Category == \\\"ICA Session\\\" or Category == \\\"RemoteFX Network\\\") and (Counter_s == \\\"Input Session Bandwidth\\\" or Counter_s == \\\"Total Received Rate\\\") and Instance_s != \\\"_Server Total\\\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, {_defaultAggBin})\",\"size\":0,\"aggregation\":3,\"title\":\"Average input bandwidth by session host (bit/s)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\"},\"customWidth\":\"35\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},\"name\":\"query - 15\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (Category == \\\"ICA Session\\\" or Category == \\\"RemoteFX Network\\\") and (Counter_s == \\\"Latency - Last Recorded\\\" or Counter_s == \\\"Current TCP RTT\\\") and Instance_s != \\\"_Server Total\\\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, {_defaultAggBin})\",\"size\":0,\"aggregation\":3,\"title\":\"Average latency by session host (ms)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\",\"chartSettings\":{\"ySettings\":{\"unit\":23,\"min\":null,\"max\":null}}},\"customWidth\":\"30\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},\"name\":\"query - 16\"},{\"type\":1,\"content\":{\"json\":\"\\r\\n\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},\"name\":\"text - 18\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and UserName_s!=\\\"\\\" and (Category == \\\"ICA Session\\\" or Category == \\\"RemoteFX Network\\\") and (Counter_s == \\\"Output Session Bandwidth\\\" or Counter_s == \\\"Total Sent Rate\\\") and Instance_s != \\\"_Server Total\\\" | summarize OutputBandwidth = avg(value_d) by User=UserName_s \\r\\n| order by OutputBandwidth desc\",\"size\":0,\"aggregation\":3,\"title\":\"Average output bandwith by user (bit/s)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"OutputBandwidth\",\"formatter\":3,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}}],\"filter\":true}},\"customWidth\":\"35\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},\"name\":\"query - 18\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (Category == \\\"ICA Session\\\" or Category == \\\"RemoteFX Network\\\") and (Counter_s == \\\"Input Session Bandwidth\\\" or Counter_s == \\\"Total Received Rate\\\") and UserName_s!=\\\"\\\" and Instance_s != \\\"_Server Total\\\" | summarize InputBandwidth = avg(value_d) by User=UserName_s \\r\\n| order by InputBandwidth desc\",\"size\":0,\"aggregation\":3,\"title\":\"Average input bandwith by user (bit/s)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"InputBandwidth\",\"formatter\":3,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}}],\"filter\":true}},\"customWidth\":\"35\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},\"name\":\"query - 19\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and (Category == \\\"ICA Session\\\" or Category == \\\"RemoteFX Network\\\") and (Counter_s == \\\"Latency - Last Recorded\\\" or Counter_s == \\\"Current TCP RTT\\\") and UserName_s!=\\\"\\\" and Instance_s != \\\"_Server Total\\\" | summarize Latency = avg(value_d) by User=UserName_s \\r\\n| order by Latency desc\",\"size\":0,\"aggregation\":3,\"title\":\"Average latency by user (ms)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Latency\",\"formatter\":3,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":23,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}}],\"filter\":true}},\"customWidth\":\"30\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Sessions\"},\"name\":\"query - 20\"},{\"type\":1,\"content\":{\"json\":\"## Applications and users\\r\\n\\r\\nThe relationship between users, applications, and resources is important to be monitored. No longer used, but licensed apps can save money if the license is decreased. An increase of CPU or memory usage of an application after an update can cause a resize of the sizing - even if administrators know the number of users using this app. Running the monitoring over a full year can reveal sessional usage of apps and more.\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Applications\"},\"name\":\"text - 21\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let IgnorePath=dynamic({_ignorePathAndApps});\\r\\nITPC_CTX_Process_CL | where  TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and UserName_s !=\\\"\\\" and (ExecutablePath_s has_any (IgnorePath))==false | summarize Count=dcount(UserName_s) by Application=Caption_s | order by Count desc\",\"size\":0,\"title\":\"Application usage by distinct users\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"categoricalbar\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Application\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Memory_OverAll\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"chartSettings\":{}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Applications\"},\"name\":\"query - 21\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let IgnorePath=dynamic({_ignorePathAndApps});\\r\\nITPC_CTX_Process_CL | where  TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and UserName_s !=\\\"\\\" and (ExecutablePath_s has_any (IgnorePath))==false | summarize Count=dcount(Caption_s) by UserName_s | order by Count desc | take 30\",\"size\":0,\"title\":\"Distinct count of application by users\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Application\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Memory_OverAll\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"chartSettings\":{\"group\":null,\"createOtherGroup\":0}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Applications\"},\"name\":\"query - 22\"},{\"type\":1,\"content\":{\"json\":\"The following pie-charts visualize the CPU and memory usage of the applications over the selected timeframe. The values have a synthetic unit showing the summarization of the CPU / memory usage over time and all session hosts. They clearly reveal the applications with the highest impact on CPU and memory (some applications are filtered to avoid showing to much default processes).\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Applications\"},\"name\":\"text - 24\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let IgnorePath=dynamic({_ignorePathAndApps});\\r\\nITPC_CTX_Process_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and UserName_s !=\\\"\\\" and  (ExecutablePath_s has_any (IgnorePath))==false | summarize CPU_OverAll=sum(PercentProcessorTime_d) by Application=Caption_s | order by CPU_OverAll desc | take 20\",\"size\":0,\"title\":\"Application CPU consumption (%*min)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Applications\"},\"name\":\"query - 12\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let IgnorePath=dynamic({_ignorePathAndApps});\\r\\nITPC_CTX_Process_CL | where  TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and UserName_s !=\\\"\\\" and (ExecutablePath_s has_any (IgnorePath))==false  | summarize Memory_OverAll=sum(WorkingSet_d) by Application=Caption_s | order by Memory_OverAll desc | take 20  \",\"size\":0,\"title\":\"Application Memory consumption (Bytes*min)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Application\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"Memory_OverAll\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Applications\"},\"name\":\"query - 24\"},{\"type\":1,\"content\":{\"json\":\"The following tables show the CPU and memory usage of the users running specific applications over the selected timeframe. The values have a synthetic unit showing the summarization of the CPU / memory usage over time by all session hosts. They clearly reveal the users with their applications having the highest impact on CPU and memory (some applications are filtered to avoid showing to much default processes).\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Applications\"},\"name\":\"text - 27\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let IgnorePath=dynamic({_ignorePathAndApps});\\r\\nITPC_CTX_Process_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and UserName_s !=\\\"\\\" and  (ExecutablePath_s has_any (IgnorePath))==false\\r\\n| summarize CPU_OverAll=sum(PercentProcessorTime_d) by User=UserName_s,Application=Caption_s | order by CPU_OverAll desc\",\"size\":0,\"title\":\"User and application usage by CPU consumption (%*min)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"CPU_OverAll\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}}],\"filter\":true}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Applications\"},\"name\":\"query - 19\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let IgnorePath=dynamic({_ignorePathAndApps});\\r\\nITPC_CTX_Process_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and UserName_s !=\\\"\\\" and  (ExecutablePath_s has_any (IgnorePath))==false\\r\\n| summarize Memory_OverAll=sum(WorkingSet_d) by User=UserName_s,Application=Caption_s | order by Memory_OverAll desc\",\"size\":0,\"title\":\"User and application usage by memory consumption (Bytes*min)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Memory_OverAll\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\"}}}],\"filter\":true}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Applications\"},\"name\":\"query - 26\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Application_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and Event_s == \\\"crashed\\\" | summarize AggregatedValue = count() by Name_s | order by AggregatedValue desc\",\"size\":1,\"title\":\"Crashed application (#)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"showBorder\":false,\"titleContent\":{\"columnMatch\":\"Name_s\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"AggregatedValue\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}},\"graphSettings\":{\"type\":0,\"topContent\":{\"columnMatch\":\"Name_s\",\"formatter\":1},\"centerContent\":{\"columnMatch\":\"AggregatedValue\",\"formatter\":1,\"numberFormat\":{\"unit\":17,\"options\":{\"maximumSignificantDigits\":3,\"maximumFractionDigits\":2}}}}},\"customWidth\":\"100\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Applications\"},\"name\":\"query - 27\"},{\"type\":1,\"content\":{\"json\":\"## Session hosts\\r\\n\\r\\nSession hosts serving the desktops and application for the WVD environment. CPU, memory, and more metrics provide information about performance and scalability.\\r\\n\\r\\nIt's essential that the CPU usage is nearly always lowered than 90% and enough memory free to handle the users' applications.\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"name\":\"text - 47\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and Category == \\\"Processor Information\\\" and Counter_s == \\\"% Processor Time\\\" \\r\\n| summarize X=1, Minimum = min(value_d), Average = avg(value_d), Maximum = max(value_d)\\r\\n| take 1\",\"size\":0,\"aggregation\":4,\"title\":\"CPU consumption over all hosts\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"unstackedbar\",\"tileSettings\":{\"showBorder\":false},\"graphSettings\":{\"type\":0},\"chartSettings\":{\"xAxis\":\"X\",\"yAxis\":[\"Minimum\",\"Maximum\",\"Average\"],\"showLegend\":true,\"xSettings\":{\"min\":1,\"max\":1},\"ySettings\":{\"unit\":1,\"min\":0,\"max\":100}}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"name\":\"query - 20\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and Category == \\\"Memory\\\" and Counter_s == \\\"Available Bytes\\\" \\r\\n| summarize X=1, Minimum = min(value_d), Average = avg(value_d), Maximum = max(value_d)\\r\\n| take 1\",\"size\":0,\"aggregation\":4,\"title\":\"Free memory over all hosts\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"unstackedbar\",\"tileSettings\":{\"showBorder\":false},\"graphSettings\":{\"type\":0},\"chartSettings\":{\"xAxis\":\"X\",\"yAxis\":[\"Minimum\",\"Maximum\",\"Average\"],\"showLegend\":true,\"xSettings\":{\"min\":1,\"max\":1},\"ySettings\":{\"unit\":2,\"min\":0,\"max\":null}}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"name\":\"query - 29\"},{\"type\":1,\"content\":{\"json\":\"## Service Level Agreements\\r\\nPart of a Service Level Agreement (SLA) can be that no longer than three minutes in a row, the CPU usage of each single session host in not higher than 90%. Additionally, free memory should never undercut 600 MByte for longer than three minutes. These values are customizable.\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"name\":\"text - 34\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and Category == \\\"Processor Information\\\" and Counter_s == \\\"% Processor Time\\\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, 3m) | where AggregatedValue>90 | summarize Count=count() by Worker_s | order by Count desc\",\"size\":0,\"aggregation\":2,\"title\":\"Infringement of SLA: CPU usage>90% over 3 minutes (#)\",\"noDataMessage\":\"No infringement of this SLA in the selected time-frame\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"name\":\"query - 30\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and Category == \\\"Memory\\\" and Counter_s == \\\"Available Bytes\\\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, 3m) | where AggregatedValue<629145600 | summarize Count=count() by Worker_s | order by Count desc\",\"size\":0,\"aggregation\":2,\"title\":\"Infringement of SLA: Free memory<600 Mbytes over 3 minutes (#)\",\"noDataMessage\":\"No infringement of this SLA in the selected time-frame\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"name\":\"query - 31\"},{\"type\":1,\"content\":{\"json\":\"## Session distributions\\r\\nMonitoring the distribution of sessions around all session hosts in a host pool can give a hint if something wrong. If one or more session hosts have a significantly lower or higher amount of sessions, a problem in load balancing could happen or that users cannot log on to specific hosts. A host pool load-balanced by depth-first can have an uneven distribution of sessions.\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"name\":\"text - 37\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Session_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" | summarize AggregatedValue=dcount(SessionHash_s) by Worker_s | order by AggregatedValue desc\",\"size\":0,\"aggregation\":2,\"title\":\"Top unique sessions by host (#)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"unstackedbar\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"name\":\"query - 32\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Session_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" | summarize AggregatedValue=dcount(SessionHash_s) by Worker_s | order by AggregatedValue asc\",\"size\":0,\"aggregation\":2,\"title\":\"Less unique sessions by host (#)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"unstackedbar\",\"chartSettings\":{}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"name\":\"query - 33\"},{\"type\":1,\"content\":{\"json\":\"## Core metrics\\r\\nThe following charts are showing the usage of resources by time and session host:\\r\\n* CPU: If a host goes close to 100% over a longer time it can not handle running application or newly started application performantly\\r\\n* Available bytes: Free memory of the hosts to launch new application and server running ones\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"name\":\"text - 40\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and Category == \\\"Processor Information\\\" and Counter_s == \\\"% Processor Time\\\" | summarize AggregatedValue = avg(value_d) by SessionHost=Worker_s, bin(TimeGenerated, {_defaultAggBin})\",\"size\":0,\"aggregation\":2,\"title\":\"CPU consumption by session host (%)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"name\":\"query - 34\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and Category == \\\"Memory\\\" and Counter_s == \\\"Available Bytes\\\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, {_defaultAggBin}) \",\"size\":0,\"aggregation\":1,\"title\":\"Available bytes by session host (Bytes)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\",\"chartSettings\":{\"ySettings\":{\"unit\":2,\"min\":null,\"max\":null}}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"name\":\"query - 35\"},{\"type\":1,\"content\":{\"json\":\"The following charts are showing the usage of resources by time and session host:\\r\\n* Network throughput: Can give a hint if session hosts transmitting a hight data over the network. If this is unexpected, happens periodically or only on a few hosts, a deeper diagnostic could help to find the applications or users causing these\\r\\n* Processor queue length: Should normally be less than than 1. Longer values over 1.5 results in bad user experience\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"name\":\"text - 43\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and Category == \\\"Network Adapter\\\" and Counter_s == \\\"Bytes Total/sec\\\" | summarize AggregatedValueS1 = avg(value_d) by Worker_s, Instance_s, bin(TimeGenerated, {_defaultAggBin}) | summarize AggregatedValue=sum(AggregatedValueS1) by Worker_s, TimeGenerated\",\"size\":0,\"aggregation\":3,\"title\":\"Network throughput (Bytes/s)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\",\"chartSettings\":{\"ySettings\":{\"unit\":2,\"min\":null,\"max\":null}}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"name\":\"query - 36\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and Category == \\\"System\\\" and Counter_s == \\\"Processor Queue Length\\\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, {_defaultAggBin}) \",\"size\":0,\"aggregation\":3,\"title\":\"Processor queue length (#)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"name\":\"query - 37\"},{\"type\":1,\"content\":{\"json\":\"The following charts are showing the usage of resources by time and session host:\\r\\n* Disk queue length: Should normally be less than than 1. Longer values over one results in bad user experience (applications launches slow, delays with the user interfaces, ...)\\r\\n* Page file usage: If it reaches 100%, no additional virtual memory can be allocated. If there is no free memory available at the same time, the system may crash or freeze\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"name\":\"text - 46\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and Category == \\\"PhysicalDisk\\\" and Counter_s == \\\"Avg. Disk Queue Length\\\" and Instance_s == \\\"_Total\\\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, {_defaultAggBin}) \",\"size\":0,\"aggregation\":3,\"title\":\"Disk queue length (#)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"name\":\"query - 38\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_PerfData_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and Category == \\\"Paging File\\\" and Counter_s == \\\"% Usage\\\" and Instance_s == \\\"_Total\\\" | summarize AggregatedValue = avg(value_d) by Worker_s, bin(TimeGenerated, {_defaultAggBin}) \",\"size\":0,\"aggregation\":3,\"title\":\"Page file usage (%)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"linechart\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"SessionHosts\"},\"name\":\"query - 39\"},{\"type\":1,\"content\":{\"json\":\"## Processes\\r\\nProcesses/applications are the heart of each WVD environment. In addition to the data, they must be brought to the user so that he can perform his tasks. All performance provided by the hosts is for the applications. It's always good to know and to monitor what processes are using what amount of CPU and memory. Even an increase in one of the metrics can be a reference to an upcoming issue.\\r\\n\\r\\nAdditionally, these data can be used to up or downsize an environment based on its needs.\\r\\n\\r\\n\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Processes\"},\"name\":\"text - 49\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Process_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and Name_s != \\\"System Idle Process\\\" | summarize AggregatedValue = avg(PercentProcessorTime_d) by Name_s, bin(TimeGenerated, {_defaultAggBin}) \",\"size\":0,\"aggregation\":3,\"title\":\"Process CPU consumption (%)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"scatterchart\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Processes\"},\"name\":\"query - 40\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Process_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and Name_s != \\\"System Idle Process\\\" | summarize CPU_Average = 0.01*avg(PercentProcessorTime_d) by Name_s | order by CPU_Average desc\",\"size\":0,\"aggregation\":1,\"title\":\"Process CPU consumption (%)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"CPU_Average\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"percent\",\"useGrouping\":false}}},{\"columnMatch\":\"AggregatedValue\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"percent\",\"useGrouping\":true}}}]}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Processes\"},\"name\":\"query - 41\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Process_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and Name_s != \\\"System Idle Process\\\" | summarize AggregatedValue = avg(WorkingSet_d) by Name_s, bin(TimeGenerated, {_defaultAggBin}) \",\"size\":0,\"aggregation\":3,\"title\":\"Process memory consumption (Bytes)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"scatterchart\",\"chartSettings\":{\"ySettings\":{\"unit\":2,\"min\":null,\"max\":null}}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Processes\"},\"name\":\"query - 42\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Process_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and Name_s != \\\"System Idle Process\\\" | summarize Memory_Average = avg(WorkingSet_d) by Name_s | order by Memory_Average desc\",\"size\":0,\"aggregation\":1,\"title\":\"Process memory consumption (Bytes)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Memory_Average\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":2,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}},{\"columnMatch\":\"CPU_Average\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"percent\",\"useGrouping\":false}}},{\"columnMatch\":\"AggregatedValue\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"percent\",\"useGrouping\":true}}}]}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Processes\"},\"name\":\"query - 43\"},{\"type\":1,\"content\":{\"json\":\"Process IO-Data consumption is a metric showing how much data a process is transferring to disk or the network. This data is valuable to identify this kind of application, having a vast IOPS fingerprint.\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Processes\"},\"name\":\"text - 54\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Process_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and Name_s != \\\"System Idle Process\\\" | summarize IOData_Average = avg(IODataBytesPersec_d) by Name_s, bin(TimeGenerated,{_defaultAggBin})\",\"size\":0,\"aggregation\":3,\"title\":\"Process IO-Data consumption (Bytes/s)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"scatterchart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOData_Average\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":11,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}},{\"columnMatch\":\"CPU_Average\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"percent\",\"useGrouping\":false}}},{\"columnMatch\":\"AggregatedValue\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"percent\",\"useGrouping\":true}}}]}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Processes\"},\"name\":\"query - 44\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Process_CL | where TimeGenerated {TimeRange} and DesktopGroup_s==\\\"{HostPool}\\\" and Name_s != \\\"System Idle Process\\\" | summarize IOData_Average = avg(IODataBytesPersec_d) by Name_s | order by IOData_Average desc\",\"size\":0,\"aggregation\":1,\"title\":\"Process IO-Data consumption (Bytes/s)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"IOData_Average\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true},\"numberFormat\":{\"unit\":11,\"options\":{\"style\":\"decimal\",\"useGrouping\":false}}}]}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Processes\"},\"name\":\"query - 45\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"nav\",\"links\":[{\"cellValue\":\"lnkMainSelector\",\"linkTarget\":\"step\",\"linkLabel\":\"Top\",\"preText\":\"\",\"style\":\"primary\"}]},\"name\":\"links - 46\"}],\"isLocked\":false}"
		}
	},
	 {
			"name": "cccc906a-c27b-4c5f-9b0e-971751c8c66c",
			"type": "microsoft.insights/workbooktemplates",
			"location": "[resourceGroup().location]",
			"apiVersion": "2019-10-17-preview",
			"dependsOn": [],
			"properties": {
				"galleries": [
					{
						"name": "WVD Fall API",
						"category": "Windows Virtual Desktop",
						"order": 110,
						"type": "workbook",
						"resourceType": "microsoft.operationalinsights/workspaces"
					}
				],
				"templateData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Windows Virtual Desktop - Backplane Fall\\r\\nThis workbook gives you an insight into the logs coming from the Windows Virtual Backplane (fall update). These data can be used to resolve issues while user connecting or shows if and when administrative tasks have occurred.\\r\\n\"},\"customWidth\":\"80\",\"name\":\"text - 0\"},{\"type\":1,\"content\":{\"json\":\"[![sepago GmbH - Germany](https://sepago.blob.core.windows.net/public/images/sepago.logo.png)](https://www.sepago.com)\"},\"customWidth\":\"20\",\"name\":\"text - 0 - Copy\"},{\"type\":1,\"content\":{\"json\":\"## Current status of your WVD environment\\r\\n\\r\\nThe following tiles show the active sessions, disconnected sessions, and the number of active session hosts by host pool name. These data are send by the Azure Monitor for WVD Agent from sepago.\"},\"name\":\"text - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Session_CL| where TimeGenerated > ago(5m) \\r\\n| summarize SessionHostActive=dcount(Worker_s), Sessions=dcount(SessionHash_s),SessionsDisconnected=dcountif(SessionHash_s,ConnectionState_s==\\\"Disconnected\\\"),SessionsActive=dcountif(SessionHash_s,ConnectionState_s!=\\\"Disconnected\\\") by HostPool=DesktopGroup_s\",\"size\":4,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"HostPool\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"SessionsActive\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}},\"tooltipFormat\":{\"tooltip\":\"Active sessions\"}},\"rightContent\":{\"columnMatch\":\"SessionsDisconnected\",\"formatOptions\":{\"showIcon\":true},\"tooltipFormat\":{\"tooltip\":\"Disconnected sessions\"}},\"secondaryContent\":{\"columnMatch\":\"SessionHostActive\",\"formatOptions\":{\"showIcon\":true},\"tooltipFormat\":{\"tooltip\":\"Active session hosts\"}},\"showBorder\":true},\"chartSettings\":{\"yAxis\":[\"SessionsActiveMax\"],\"group\":\"HostPool\",\"createOtherGroup\":null,\"showLegend\":true}},\"name\":\"query - 2\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Logins & Connections\",\"subTarget\":\"Logins\",\"style\":\"link\"},{\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Administration\",\"subTarget\":\"Administration\",\"style\":\"link\"},{\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Failure statistic\",\"subTarget\":\"Errors\",\"style\":\"link\"}]},\"name\":\"links - 3\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"88bda73f-158a-4971-9310-1e557a8f89f0\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"label\":\"Time Range\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":604800000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":900000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"resourceType\":\"microsoft.insights/components\"}],\"style\":\"pills\",\"doNotRunWhenHidden\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"se\",\"comparison\":\"isEqualTo\"},\"name\":\"parameters - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDActivityV1_CL | where TimeGenerated {TimeRange} and Type_s =~ \\\"Connection\\\" | summarize Count=count() by State=Outcome_s\",\"size\":1,\"title\":\"Brokered sessions\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Time_t\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"DurationFromLogon\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"UserName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Name_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Parameters_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ResourceType\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SessionHostName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ActivityId_g\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SessionHostPoolName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Outcome_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Id_g\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"StartTime_t\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TenantId\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SourceSystem\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"MG\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ManagementGroupName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Computer\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"RawData\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ReportedBy_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Type\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"_ResourceId\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Id_g1\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"$gen_group\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"ActivityId_g\"],\"expandTopLevel\":true,\"finalBy\":\"UserName_s\"}}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Logins\"},\"name\":\"query - 20\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDActivityV1_CL \\r\\n| where TimeGenerated {TimeRange} and Type_s =~\\\"Connection\\\" | project ResourceType, SessionHostPoolName_s, SessionHostName_s , UserName_s ,Outcome_s, Id_g, TenantId_s, StartTime_t, DesktopGroup_s=toupper(strcat(TenantId_s,\\\".\\\",SessionHostPoolName_s)) \\r\\n| join kind= leftouter (\\r\\n    WVDCheckpointV1_CL | where TimeGenerated {TimeRange} | extend Id_g=ActivityId_g \\r\\n) on Id_g\\r\\n| extend DurationFromLogon=datetime_diff(\\\"Second\\\",Time_t,StartTime_t)\\r\\n| where Name_s=~\\\"RdpStackLogon\\\" \\r\\n| project UserName=UserName_s, Tenant=TenantId_s, HostPool=SessionHostPoolName_s,SessionHost=SessionHostName_s, TimeStamp=StartTime_t , DurationFromLogon, DesktopGroup_s\\r\\n| summarize DurationInSeconds=avg(DurationFromLogon) by HostPool=DesktopGroup_s \",\"size\":1,\"title\":\"Session logon time (s)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"User\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Tenant\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"HostPool\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ResourceType\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SessionHost\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ClientOS\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ClientWvdVersion\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"UserName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Count\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Time_t\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"DurationFromLogon\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"UserName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Name_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Parameters_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SessionHostName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ActivityId_g\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SessionHostPoolName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Outcome_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Id_g\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"StartTime_t\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TenantId\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SourceSystem\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"MG\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ManagementGroupName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Computer\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"RawData\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ReportedBy_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Type\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"_ResourceId\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Id_g1\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"filter\":true}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Logins\"},\"name\":\"query - 20 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDActivityV1_CL | where TimeGenerated {TimeRange} and Type_s =~ \\\"Connection\\\" and Outcome_s=~\\\"Failure\\\" |project TimeStamp=TimeGenerated, User=UserName_s, Tenant=TenantId_s, HostPool=SessionHostPoolName_s,ResourceType, SessionHost=SessionHostName_s, ClientOS=ClientOS_s, ClientWvdVersion=ClientVersion_s, Id_g| order by TimeStamp desc\",\"size\":1,\"title\":\"Failed sessions\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"Id_g\",\"exportParameterName\":\"_ActivityId\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"User\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Tenant\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"HostPool\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ResourceType\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SessionHost\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ClientOS\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ClientWvdVersion\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"UserName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Count\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Time_t\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"DurationFromLogon\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"UserName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Name_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Parameters_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SessionHostName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ActivityId_g\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SessionHostPoolName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Outcome_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Id_g\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"StartTime_t\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TenantId\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SourceSystem\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"MG\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ManagementGroupName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Computer\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"RawData\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ReportedBy_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Type\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"_ResourceId\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Id_g1\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Logins\"},\"name\":\"query - 20 - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDActivityV1_CL | where TimeGenerated {TimeRange} and (Id_g==\\\"{_ActivityId}\\\" or isempty(\\\"{_ActivityId}\\\")) |order by TimeGenerated desc\\r\\n| where Type_s =~\\\"Connection\\\" | project ResourceType, SessionHostPoolName_s, SessionHostName_s , UserName_s ,Outcome_s, Id_g, StartTime_t \\r\\n| join kind= leftouter (\\r\\n    WVDCheckpointV1_CL | where TimeGenerated {TimeRange} | extend Id_g=ActivityId_g \\r\\n) on Id_g\\r\\n| extend DurationFromLogon=Time_t-StartTime_t \\r\\n| project  TimeStamp=Time_t, DurationFromLogon, UserName=UserName_s, Success=Outcome_s=~\\\"Failure\\\", Operation=Name_s, Parameters=Parameters_s, ResourceType ,SessionHost=SessionHostName_s, ActivityId_g, TimeGenerated\\r\\n| order by TimeGenerated desc, TimeStamp asc\",\"size\":1,\"title\":\"Last user logon logs (filtered by failed sessions)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Time_t\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"DurationFromLogon\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"UserName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Name_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Parameters_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ResourceType\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SessionHostName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ActivityId_g\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SessionHostPoolName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Outcome_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Id_g\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"StartTime_t\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TenantId\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SourceSystem\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"MG\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ManagementGroupName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Computer\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"RawData\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ReportedBy_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Type\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"_ResourceId\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Id_g1\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"$gen_group\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"ActivityId_g\"],\"expandTopLevel\":true,\"finalBy\":\"UserName_s\"}}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Logins\"},\"name\":\"query - 20 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDActivityV1_CL | where TimeGenerated {TimeRange} and  (Id_g==\\\"{_ActivityId}\\\" or isempty(\\\"{_ActivityId}\\\")) |order by TimeGenerated desc\\r\\n| where Type_s =~\\\"Connection\\\" | project ResourceType, SessionHostPoolName_s, SessionHostName_s , UserName_s ,Outcome_s, Id_g, StartTime_t \\r\\n| join kind= leftouter (\\r\\n    WVDErrorV1_CL | where TimeGenerated {TimeRange} | extend Id_g=ActivityId_g \\r\\n) on Id_g \\r\\n| extend DurationFromLogon=Time_t-StartTime_t \\r\\n| project  TimeStamp=Time_t, DurationFromLogon, UserName=UserName_s, ResourceType ,SessionHost=SessionHostName_s, Operations=ErrorOperation_s , ErrorCodeSymbolic=ErrorCodeSymbolic_s , ErrorMessage=ErrorMessage_s, ErrorCode=ErrorCode_s, ErrorSource=ErrorSource_s ,IsInternal=ErrorInternal_s, ReportedBy=ReportedBy_s , ActivityId_g\\r\\n| order by TimeStamp desc\",\"size\":1,\"title\":\"Last user logon errors (filtered by failed sessions)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"TimeStamp\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"DurationFromLogon\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"UserName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ResourceType\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SessionHost\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Operations\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ErrorCodeSymbolic\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ErrorMessage\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ErrorCode\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ErrorSource\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"IsInternal\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ReportedBy\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ActivityId_g\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TimeGenerated\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Time_t\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"UserName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Name_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Parameters_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SessionHostName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SessionHostPoolName_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Outcome_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Id_g\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"StartTime_t\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"TenantId\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"SourceSystem\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"MG\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ManagementGroupName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Computer\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"RawData\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"ReportedBy_s\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Type\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"_ResourceId\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Id_g1\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Logins\"},\"name\":\"query - 20 - Copy - Copy\"},{\"type\":1,\"content\":{\"json\":\"This log shows how and when administrators made changes in the WVD environment. These contain querying, creating, updating, removing resources. Resource are tenants, host pool, app groups, etc.\\nEven the state of operations is logged: successful or not. Especially, un-successful write-operations can be an indication of an attack.\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Administration\"},\"name\":\"text - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDActivityV1_CL | where TimeGenerated {TimeRange} and Outcome_s =~ \\\"success\\\"\\r\\n| summarize count() by Method_s, Outcome_s\",\"size\":1,\"title\":\"Successful write operations\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Administration\"},\"name\":\"query - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDActivityV1_CL | where TimeGenerated {TimeRange} and Outcome_s !~ \\\"success\\\"\\r\\n| summarize count() by Method_s, Outcome_s\",\"size\":1,\"title\":\"Un-successful write operations\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Administration\"},\"name\":\"query - 6\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDActivityV1_CL | where TimeGenerated {TimeRange} | summarize count() by bin(TimeGenerated,15), Outcome_s\",\"size\":1,\"title\":\"Administrativ read/write operations\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"scatterchart\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Administration\"},\"name\":\"query - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDActivityV1_CL | where TimeGenerated {TimeRange} and (Method_s =~ \\\"update\\\" or Method_s =~ \\\"add\\\" or Method_s =~ \\\"remove\\\" or Method_s =~ \\\"update\\\") and Outcome_s =~ \\\"success\\\" | extend x=split(replace(\\\"%20\\\",\\\" \\\",Object_s), \\\"/\\\") | extend TenantGroup=x[4], Tenant=x[6], HostPool=x[8], UserName=case(isempty(UserName_s), UserName_g,UserName_s) | project-away x\\r\\n| summarize Count=count() by tostring(Tenant), tostring(HostPool)\\r\\n| order by Tenant, HostPool \",\"size\":1,\"title\":\"Successful write operations\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Administration\"},\"name\":\"query - 8\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDActivityV1_CL | where TimeGenerated {TimeRange} and (Method_s =~ \\\"update\\\" or Method_s =~ \\\"add\\\" or Method_s =~ \\\"remove\\\" or Method_s =~ \\\"update\\\") and Outcome_s !~ \\\"success\\\" | extend x=split(replace(\\\"%20\\\",\\\" \\\",Object_s), \\\"/\\\") | extend TenantGroup=x[4], Tenant=x[6], HostPool=x[8], UserName=case(isempty(UserName_s), UserName_g,UserName_s) | project-away x\\r\\n| summarize Count=count() by tostring(Tenant), tostring(HostPool), UserName\\r\\n| order by Tenant, HostPool \",\"size\":1,\"title\":\"Un-successful write operations\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Administration\"},\"name\":\"query - 9\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDActivityV1_CL | where TimeGenerated {TimeRange} and Outcome_s !~ \\\"success\\\" | extend x=split(replace(\\\"%20\\\",\\\" \\\",Object_s), \\\"/\\\") | extend TenantGroup=x[4], Tenant=x[6], HostPool=x[8], UserName=case(isempty(UserName_s), UserName_g,UserName_s) | project-away x\\r\\n| summarize Count=count() by UserName, tostring(Tenant), tostring(HostPool)\\r\\n| order by UserName \",\"size\":0,\"title\":\"Un-successful operations (read/write)\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"UserName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Tenant\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"HostPool\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"count_\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}]}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Administration\"},\"name\":\"query - 10\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDActivityV1_CL | where TimeGenerated {TimeRange} and Outcome_s !~ \\\"success\\\" | extend x=split(replace(\\\"%20\\\",\\\" \\\",Object_s), \\\"/\\\") | extend TenantGroup=x[4], Tenant=x[6], HostPool=x[8], UserName=case(isempty(UserName_s), UserName_g,UserName_s) | project-away TenantId, SourceSystem, MG, ManagementGroupName, Computer, RawData, x\\r\\n| order by TimeGenerated desc\",\"size\":0,\"title\":\"Data table\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"UserName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Tenant\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"HostPool\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"count_\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Administration\"},\"name\":\"query - 11\"},{\"type\":1,\"content\":{\"json\":\"The error log is the best place to start troubleshooting of issues like connection problems. The log shows the reason for unsuccessful connection like unhealthy session hosts, session hosts with disabled logons, or hosts have reached their maximum connection count.\\nUnexpected disconnected sessions could be caused by the host, the client, or network issues. Dig deeper into the log to find and eliminate the root cause.\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Errors\"},\"name\":\"text - 13\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDErrorV1_CL | where TimeGenerated {TimeRange} | summarize Count=count() by ErrorCodeSymbolic_s\",\"size\":1,\"title\":\"Errors by reason\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"UserName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Tenant\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"HostPool\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"count_\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"filter\":true}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Errors\"},\"name\":\"query - 12\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDErrorV1_CL | where TimeGenerated {TimeRange} | summarize Count=count() by ErrorSource_s\",\"size\":1,\"title\":\"Errors by source\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"UserName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Tenant\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"HostPool\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"count_\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"filter\":true}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Errors\"},\"name\":\"query - 13\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDErrorV1_CL | where TimeGenerated {TimeRange} | summarize Count=count() by bin(TimeGenerated, 15m), ErrorCodeSymbolic_s\",\"size\":1,\"title\":\"Errors raised by time\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"scatterchart\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"UserName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Tenant\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"HostPool\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"count_\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Errors\"},\"name\":\"query - 14\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDErrorV1_CL | where TimeGenerated {TimeRange} | project-away TenantId, SourceSystem, MG, ManagementGroupName, Computer, RawData | order by TimeGenerated desc\",\"size\":0,\"title\":\"Errors table\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"UserName\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"Tenant\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"HostPool\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}},{\"columnMatch\":\"count_\",\"formatter\":0,\"formatOptions\":{\"showIcon\":true}}],\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Errors\"},\"name\":\"query - 15\"},{\"type\":1,\"content\":{\"json\":\"The checkpoint log shows important steps while brokering connections. It can give a hint about why something happens as it is. It contains information about load balancing user sessions.\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Checkpoints\"},\"name\":\"text - 18\"}],\"isLocked\":false}"
			}
		},
	 {
			"name": "d4804794-bae3-4f27-afb3-560ccf89d7f6",
			"type": "microsoft.insights/workbooktemplates",
			"location": "[resourceGroup().location]",
			"apiVersion": "2019-10-17-preview",
			"dependsOn": [],
			"properties": {
				"galleries": [
					{
						"name": "WVD Spring API",
						"category": "Windows Virtual Desktop",
						"order": 105,
						"type": "workbook",
						"resourceType": "microsoft.operationalinsights/workspaces"
					}
				],
				"templateData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"# Windows Virtual Desktop - Backplane Spring\\r\\nThis workbook gives you an insight into the logs coming from the Windows Virtual Backplane (spring update). These data can be used to resolve issues while user connecting or shows if and when administrative tasks have occurred.\\r\\n\"},\"customWidth\":\"80\",\"name\":\"text - 0\"},{\"type\":1,\"content\":{\"json\":\"[![sepago GmbH - Germany](https://sepago.blob.core.windows.net/public/images/sepago.logo.png)](https://www.sepago.com)\"},\"customWidth\":\"20\",\"name\":\"text - 0 - Copy\"},{\"type\":1,\"content\":{\"json\":\"## Current status of your WVD environment\\r\\n\\r\\nThe following tiles show the active sessions, disconnected sessions, and the number of active session hosts by host pool name. These data are send by the Azure Monitor for WVD Agent from sepago.\"},\"name\":\"text - 1\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"ITPC_CTX_Session_CL| where TimeGenerated > ago(5m) \\r\\n| summarize SessionHostActive=dcount(Worker_s), Sessions=dcount(SessionHash_s),SessionsDisconnected=dcountif(SessionHash_s,ConnectionState_s==\\\"Disconnected\\\"),SessionsActive=dcountif(SessionHash_s,ConnectionState_s!=\\\"Disconnected\\\") by HostPool=DesktopGroup_s\",\"size\":4,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"HostPool\",\"formatter\":1,\"formatOptions\":{\"showIcon\":true}},\"leftContent\":{\"columnMatch\":\"SessionsActive\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\",\"showIcon\":true},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":2,\"maximumSignificantDigits\":3}},\"tooltipFormat\":{\"tooltip\":\"Active sessions\"}},\"rightContent\":{\"columnMatch\":\"SessionsDisconnected\",\"formatOptions\":{\"showIcon\":true},\"tooltipFormat\":{\"tooltip\":\"Disconnected sessions\"}},\"secondaryContent\":{\"columnMatch\":\"SessionHostActive\",\"formatOptions\":{\"showIcon\":true},\"tooltipFormat\":{\"tooltip\":\"Active session hosts\"}},\"showBorder\":true},\"chartSettings\":{\"yAxis\":[\"SessionsActiveMax\"],\"group\":\"HostPool\",\"createOtherGroup\":null,\"showLegend\":true}},\"name\":\"query - 2\"},{\"type\":11,\"content\":{\"version\":\"LinkItem/1.0\",\"style\":\"tabs\",\"links\":[{\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Logins & Connections\",\"subTarget\":\"Logins\",\"style\":\"link\"},{\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Administration\",\"subTarget\":\"Administration\",\"style\":\"link\"},{\"cellValue\":\"selectedTab\",\"linkTarget\":\"parameter\",\"linkLabel\":\"Failure statistic\",\"subTarget\":\"Errors\",\"style\":\"link\"}]},\"name\":\"links - 3\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"88bda73f-158a-4971-9310-1e557a8f89f0\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"label\":\"Time Range\",\"type\":4,\"isRequired\":true,\"value\":{\"durationMs\":604800000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":900000},{\"durationMs\":3600000},{\"durationMs\":14400000},{\"durationMs\":43200000},{\"durationMs\":86400000},{\"durationMs\":259200000},{\"durationMs\":604800000},{\"durationMs\":2592000000},{\"durationMs\":5184000000},{\"durationMs\":7776000000}],\"allowCustom\":true},\"resourceType\":\"microsoft.insights/components\"}],\"style\":\"pills\",\"doNotRunWhenHidden\":true,\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"conditionalVisibility\":{\"parameterName\":\"se\",\"comparison\":\"isEqualTo\"},\"name\":\"parameters - 4\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDConnections | where TimeGenerated {TimeRange} and State =~ \\\"Started\\\" and Type =~\\\"WVDConnections\\\" | extend CState=iff(SessionHostOSVersion==\\\"<>\\\",\\\"Failure\\\",\\\"Success\\\") | summarize Count=count() by State=CState\",\"size\":1,\"title\":\"Brokered sessions\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"ActivityId_g\"],\"expandTopLevel\":true,\"finalBy\":\"UserName_s\"}}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Logins\"},\"name\":\"query - 20\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDConnections \\r\\n| where TimeGenerated {TimeRange} and Type =~\\\"WVDConnections\\\" and State =~ \\\"Started\\\" | extend Multi=split(_ResourceId, \\\"/\\\") | project ResourceAlias, HostPool=toupper(HP=Multi[8]), SessionHostName , UserName ,CState=iff(SessionHostOSVersion==\\\"<>\\\",\\\"Failure\\\",\\\"Success\\\"), CorrelationId, TimeGenerated, ResourceGroup=Multi[4], DesktopGroup_s=toupper(strcat(RG=Multi[4],\\\".\\\", HP=Multi[8])) \\r\\n| join kind= leftouter (\\r\\n    WVDCheckpoints | where TimeGenerated {TimeRange} \\r\\n) on CorrelationId\\r\\n| extend DurationFromLogon=datetime_diff(\\\"Second\\\",TimeGenerated1,TimeGenerated)\\r\\n| where Name=~\\\"RdpStackLogon\\\" \\r\\n| project UserName, ResourceGroup, DesktopGroup_s,SessionHost=SessionHostName, TimeStamp=TimeGenerated1, DurationFromLogon\\r\\n| summarize DurationInSeconds=avg(DurationFromLogon) by HostPool=DesktopGroup_s \",\"size\":1,\"title\":\"Session logon time (s)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"filter\":true},\"chartSettings\":{\"ySettings\":{\"numberFormatSettings\":{\"unit\":24,\"options\":{\"style\":\"decimal\",\"useGrouping\":true}}}}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Logins\"},\"name\":\"query - 20 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDConnections | where TimeGenerated {TimeRange} and State =~ \\\"Started\\\" and Type =~\\\"WVDConnections\\\" | extend Multi=split(_ResourceId, \\\"/\\\") | extend CState=iff(SessionHostOSVersion==\\\"<>\\\",\\\"Failure\\\",\\\"Success\\\")| where CState=~\\\"Failure\\\" | project TimeStamp=TimeGenerated, UserName, ResourceGroup=Multi[4], HostPool=Multi[8],ResourceAlias, SessionHost=SessionHostName, ClientOS=ClientOS, ClientWvdVersion=ClientVersion, CorrelationId| order by TimeStamp desc\",\"size\":1,\"title\":\"Failed sessions\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"exportFieldName\":\"CorrelationId\",\"exportParameterName\":\"_ActivityId\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Logins\"},\"name\":\"query - 20 - Copy - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDConnections | where TimeGenerated {TimeRange} and (CorrelationId==\\\"{_ActivityId}\\\" or isempty(\\\"{_ActivityId}\\\")) |order by TimeGenerated desc\\r\\n| where State =~ \\\"Started\\\" | extend Multi=split(_ResourceId, \\\"/\\\") | project ResourceAlias, ResourceGroup=Multi[4], HostPool=Multi[8], SessionHostName ,UserName ,CState=iff(SessionHostOSVersion==\\\"<>\\\",\\\"Failure\\\",\\\"Success\\\"), CorrelationId, TimeGenerated\\r\\n| join kind= leftouter (\\r\\n    WVDCheckpoints | where TimeGenerated {TimeRange}\\r\\n) on CorrelationId\\r\\n| extend DurationFromLogon=datetime_diff(\\\"Second\\\",TimeGenerated1,TimeGenerated)\\r\\n| project  TimeStamp=TimeGenerated, DurationFromLogon, UserName, Success=CState=~\\\"Failure\\\", Operation=Name, Parameters, ResourceAlias ,SessionHost=SessionHostName, CorrelationId, TimeGenerated\\r\\n| order by TimeGenerated desc, TimeStamp asc\\r\\n\",\"size\":1,\"title\":\"Last user logon logs (filtered by failed sessions)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"rowLimit\":1000,\"filter\":true,\"hierarchySettings\":{\"treeType\":1,\"groupBy\":[\"ActivityId_g\"],\"expandTopLevel\":true,\"finalBy\":\"UserName_s\"}}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Logins\"},\"name\":\"query - 20 - Copy\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDConnections | where TimeGenerated {TimeRange} and (CorrelationId==\\\"{_ActivityId}\\\" or isempty(\\\"{_ActivityId}\\\")) |order by TimeGenerated desc\\r\\n| where State =~ \\\"Started\\\" | extend Multi=split(_ResourceId, \\\"/\\\") | project ResourceAlias, ResourceGroup=Multi[4], HostPool=Multi[8], SessionHostName ,UserName ,CState=iff(SessionHostOSVersion==\\\"<>\\\",\\\"Failure\\\",\\\"Success\\\"), CorrelationId, TimeGenerated\\r\\n| join kind= leftouter (\\r\\n    WVDErrors | where TimeGenerated {TimeRange}\\r\\n) on CorrelationId\\r\\n| extend DurationFromLogon=datetime_diff(\\\"Second\\\",TimeGenerated1,TimeGenerated)\\r\\n| project  TimeStamp=TimeGenerated, DurationFromLogon, UserName, ResourceAlias ,SessionHost=SessionHostName ,Source ,CodeSymbolic , ErrorMessage=Message, ErrorCode=Code, ErrorSource=Source ,ServiceError, CorrelationId\\r\\n| order by TimeStamp desc\",\"size\":1,\"title\":\"Last user logon errors (filtered by failed sessions)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Logins\"},\"name\":\"query - 20 - Copy - Copy\"},{\"type\":1,\"content\":{\"json\":\"This log shows how and when administrators made changes in the WVD environment. These contain querying, creating, updating, removing resources. Resource are resource groups, host pool, app groups, etc.\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Administration\"},\"name\":\"text - 5\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDManagement | where TimeGenerated {TimeRange} | summarize Count=count() by bin(TimeGenerated,15)\",\"size\":1,\"title\":\"Administrativ read/write operations\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"scatterchart\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Administration\"},\"name\":\"query - 7\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDManagement | where TimeGenerated {TimeRange} | extend Multi=split(_ResourceId, \\\"/\\\") | extend ResourceGroup=Multi[4], HostPool=Multi[8], UserName \\r\\n| project-away TenantId, Multi\\r\\n| order by TimeGenerated desc\",\"size\":0,\"title\":\"Data table\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"gridSettings\":{\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Administration\"},\"name\":\"query - 11\"},{\"type\":1,\"content\":{\"json\":\"The error log is the best place to start troubleshooting of issues like connection problems. The log shows the reason for unsuccessful connection like unhealthy session hosts, session hosts with disabled logons, or hosts have reached their maximum connection count.\\nUnexpected disconnected sessions could be caused by the host, the client, or network issues. Dig deeper into the log to find and eliminate the root cause.\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Errors\"},\"name\":\"text - 13\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDErrors | where TimeGenerated {TimeRange} | summarize Count=count() by CodeSymbolic\",\"size\":1,\"title\":\"Errors by reason\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"filter\":true}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Errors\"},\"name\":\"query - 12\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDErrorV1_CL | where TimeGenerated {TimeRange} | summarize Count=count() by ErrorSource_s\",\"size\":1,\"title\":\"Errors by source\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"gridSettings\":{\"filter\":true}},\"customWidth\":\"50\",\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Errors\"},\"name\":\"query - 13\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDErrors | where TimeGenerated {TimeRange} | summarize Count=count() by bin(TimeGenerated, 15m), CodeSymbolic\",\"size\":1,\"title\":\"Errors raised by time\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"scatterchart\",\"gridSettings\":{\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Errors\"},\"name\":\"query - 14\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"WVDErrors | where TimeGenerated {TimeRange}\\r\\n| extend Multi=split(_ResourceId, \\\"/\\\") | extend ResourceGroup=Multi[4], HostPool=Multi[8], UserName \\r\\n| project-away TenantId, Multi | order by TimeGenerated desc\",\"size\":0,\"title\":\"Errors table\",\"timeContext\":{\"durationMs\":2592000000},\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"filter\":true}},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Errors\"},\"name\":\"query - 15\"},{\"type\":1,\"content\":{\"json\":\"The checkpoint log shows important steps while brokering connections. It can give a hint about why something happens as it is. It contains information about load balancing user sessions.\"},\"conditionalVisibility\":{\"parameterName\":\"selectedTab\",\"comparison\":\"isEqualTo\",\"value\":\"Checkpoints\"},\"name\":\"text - 18\"}],\"isLocked\":false}"
			}
		}
   ]
}